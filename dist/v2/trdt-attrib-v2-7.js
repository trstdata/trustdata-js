!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AttributionCore=t():e.AttributionCore=t()}(this,(()=>(()=>{"use strict";var e={};const t=function(){return{page_location:document.location.href,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)}};function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return(t=function(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}var a=function(){return Math.floor(1*new Date/1e3)},c=function(e){if(!e)return"";try{return new URL(e).hostname}catch(e){return console.error("Error parsing URL:",e),""}},u=function(){return a()},l=function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).error.apply(e,["[Attribution Core]"].concat(r))},d=function(e,t,n,s,a){t.debug&&console.log("[Attribution Core] Creating payload - isFirstVisit: ".concat(n.isFirstVisit,", isNewVisit: ").concat(n.isNewVisit,", ignoreReferrer: ").concat(n.ignoreReferrer));var l=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e),d=l.event_name;delete l.event_name;var f={attribution_id:t.attributionIds,client_id:n.clientId,session_id:n.sessionId,session_number:n.sessionNumber,session_engaged:n.sessionEngaged?1:0,event_time:u()};null!==n.userId&&void 0!==n.userId&&""!==n.userId&&(f.user_id=n.userId),Object.entries(f).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];void 0===l[n]&&(l[n]=o)}));var g=n.isFirstVisit;!0===n.isNewVisit&&void 0===l.entrances&&(l.entrances=1,t.debug&&console.log("[Attribution Core] Added entrances=1 to payload")),!0===g&&void 0===l.first_visit&&(l.first_visit=1,t.debug&&console.log("[Attribution Core] Added first_visit=1 to payload"));var b="undefined"!=typeof window?c(window.location.href):"",v="undefined"!=typeof document?c(document.referrer):"";if(b&&v&&b===v&&(n.ignoreReferrer=!0,t.debug&&console.log("[Attribution Core] Setting ignore_referrer to true - current domain: ".concat(b,", referrer domain: ").concat(v))),!0===n.ignoreReferrer&&void 0===l.ignore_referrer?(l.ignore_referrer=!0,t.debug&&console.log("[Attribution Core] Added ignore_referrer=true to payload")):"undefined"!=typeof document&&document.referrer&&void 0===l.page_referrer&&(l.page_referrer=document.referrer,t.debug&&console.log("[Attribution Core] Added referrer: ".concat(l.page_referrer))),"undefined"!=typeof window&&window.location)try{var _=new URLSearchParams(window.location.search),p={};["utm_source","utm_medium","utm_campaign","utm_term","utm_content","trdt_cpid","trdt_agid","trdt_kwid","trdt_ctid"].forEach((function(e){var t=_.get(e);t&&void 0===l[e]&&(l[e]=t,p[e]=t)})),t.debug&&Object.keys(p).length>0&&console.log("[Attribution Core] Added URL parameters: "+JSON.stringify(p))}catch(e){t.debug&&console.error("[Attribution Core] Error extracting URL parameters:",e)}if("undefined"!=typeof document&&a){var m=a();Object.entries(m).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];void 0===l[n]&&(l[n]=o)})),t.debug&&console.log("[Attribution Core] Added page data where needed")}var y={};return Object.entries(n.persistentParameters).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];void 0===l[n]&&(l[n]=o,y[n]=o)})),t.debug&&Object.keys(y).length>0&&console.log("[Attribution Core] Added persistent parameters: "+JSON.stringify(y)),void 0===l.consent_analytics&&(l.consent_analytics=n.consentStatus.analytics),void 0===l.consent_advertising&&(l.consent_advertising=n.consentStatus.advertising),void 0===l.consent_personalization&&(l.consent_personalization=n.consentStatus.personalization),d&&(l.event_name=d),l};const f=function(e){return!0===e.analytics},g={get:function(e,t){if(!t||"undefined"==typeof document)return null;for(var r=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(r))return decodeURIComponent(i.substring(r.length,i.length))}return null},set:function(e,t,r,n,o,i){if(n&&"undefined"!=typeof document){var s="";if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3),s="; expires="+a.toUTCString()}var c=o?"; domain="+o:"",u=i?"; Secure":"";document.cookie=e+"="+encodeURIComponent(t)+s+c+"; path=/; SameSite=Lax"+u}},remove:function(e,t,r){if(t&&"undefined"!=typeof document){var n=r?"; domain="+r:"";document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"+n+"; SameSite=Lax"}}},b={get:function(e,t,r){if(!t)return null;try{return localStorage.getItem(e)}catch(e){return r&&console.warn("[Attribution Core] localStorage access error",e),null}},set:function(e,t,r,n){if(r)try{localStorage.setItem(e,t)}catch(e){n&&console.warn("[Attribution Core] localStorage set error",e)}},remove:function(e,t,r){if(t)try{localStorage.removeItem(e)}catch(e){r&&console.warn("[Attribution Core] localStorage remove error",e)}}};var v={sendDirectRequest:function(e,t,r){t.attributionIds.forEach((function(n){var o=Object.assign({},e);if(o.attribution_id=n,"undefined"!=typeof fetch)fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),keepalive:!0}).catch((function(e){console.error("[Attribution Core] Failed to send event:",e),r(o)}));else{var i=new XMLHttpRequest;i.open("POST",t.endpoint,!0),i.setRequestHeader("Content-Type","application/json"),i.timeout=1e4,i.onreadystatechange=function(){4===i.readyState&&(i.status<200||i.status>=300)&&(console.error("[Attribution Core] Failed to send event, status:",i.status),r(o))},i.onerror=function(){console.error("[Attribution Core] XHR error when sending event"),r(o)},i.send(JSON.stringify(o))}}))},sendViaServiceWorker:function(e,t){var r="msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));navigator.serviceWorker.controller.postMessage({action:"recordEvent",endpoint:t.endpoint,payload:e,messageId:r,timestamp:Date.now()})},sendBeacon:function(e,t){t.attributionIds.forEach((function(r){var n=Object.assign({},e);n.attribution_id=r,navigator.sendBeacon(t.endpoint,new Blob([JSON.stringify(n)],{type:"application/json"}))}))}};const _=v;var p={register:function(e,t,r){if(!e.useServiceWorker||!t.consentStatus.analytics||void 0===navigator.serviceWorker)return!1;try{navigator.serviceWorker.register(e.swPath).then((function(t){e.debug&&console.log("[Attribution Core] Service Worker registered:",t),window.addEventListener("online",(function(){e.debug&&console.log("[Attribution Core] Online - processing offline events"),r()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&(e.debug&&console.log("[Attribution Core] Page visible - processing offline events"),r())}))})).catch((function(e){console.error("[Attribution Core] Service Worker registration failed:",e)}))}catch(e){return console.error("[Attribution Core] Error registering Service Worker:",e),!1}return!0},canUseServiceWorker:function(){return"undefined"!=typeof navigator&&void 0!==navigator.serviceWorker&&null!==navigator.serviceWorker.controller},unregister:function(){return void 0===navigator.serviceWorker?Promise.resolve(!1):navigator.serviceWorker.getRegistrations().then((function(e){var t=e.map((function(e){return e.unregister()}));return Promise.all(t)})).catch((function(e){return console.error("[Attribution Core] Error unregistering Service Workers:",e),!1}))}};const m=p,y=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t._trdt_uat_queue&&t._trdt_uat_queue.length){r&&console.log("[Attribution Core] Processing",t._trdt_uat_queue.length,"queued commands");var n={consent:1,config:2,set:3,event:4,get:5},o=t._trdt_uat_queue.slice();t._trdt_uat_queue=[],o.sort((function(e,t){return(n[e[0]]||999)-(n[t[0]]||999)})),r&&console.log("[Attribution Core] Commands sorted by priority:",o.map((function(e){return e[0]}))),o.forEach((function(t){try{var n=t[0],o=t.slice(1);r&&console.log("[Attribution Core] Processing command:",n),e[n]?e[n].apply(e,o):r&&console.warn("[Attribution Core] Unknown command:",n)}catch(e){r&&console.error("[Attribution Core] Error processing command:",e)}})),r&&console.log("[Attribution Core] Queue processing complete")}},h=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._trdt_uat_queue=e._trdt_uat_queue||[],e._trdt_uat_queue.push(t),r&&t&&t.length>0&&console.log("[Attribution Core] Added to queue:",t[0]),!0},S=function(e,t,r,n){if(t&&r)try{var o=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");o.push({payload:e,timestamp:Date.now()}),localStorage.setItem("_trdt_uat_offline",JSON.stringify(o)),n&&console.log("[Attribution Core] Saved event for offline processing")}catch(e){console.error("[Attribution Core] Failed to save event for offline processing",e)}},w=function(e,t,r,n){if(t&&r)try{var o=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");if(0===o.length)return;n&&console.log("[Attribution Core] Processing ".concat(o.length," offline events"));var i=[];o.forEach((function(t){try{fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload),keepalive:!0}).catch((function(){i.push(t)}))}catch(e){i.push(t)}})),localStorage.setItem("_trdt_uat_offline",JSON.stringify(i)),n&&console.log("[Attribution Core] Processed offline events, ".concat(i.length," remaining"))}catch(e){console.error("[Attribution Core] Error processing offline events",e)}};function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}return function(e,r,n){e._trdt_uat_ready=!1,e._trdt_uat=e._trdt_uat||{},e._trdt_uat_queue=e._trdt_uat_queue||[];var o={version:"2.0.1",debug:!1,endpoint:"https://t.trstdata.com/api/events",swPath:"https://cdn.jsdelivr.net/gh/trstdata/trustdata-js@main/dist/v1/core-sw-v1.js",useServiceWorker:"serviceWorker"in navigator,offlineStorage:!0,sessionTimeout:30,initialized:!1,attributionIds:[],cookieDomain:"",cookieSecure:!0},i={clientId:null,userId:null,sessionId:null,sessionNumber:0,sessionEngaged:!1,isNewVisit:!1,isFirstVisit:!1,ignoreReferrer:!1,consentStatus:{analytics:!1,advertising:!1,personalization:!1},persistentParameters:{},initializedTargets:new Set},s={config:function(t){var r=this,c=arguments.length>1&&arguments[1]!==n?arguments[1]:{};return t&&!o.attributionIds.includes(t)&&o.attributionIds.push(t),Object.assign(o,c),c.consent&&this.consent("update",{consent:c.consent}),function(){var e=arguments.length>0&&arguments[0]!==n?arguments[0]:{},t=f(i.consentStatus);o.debug&&console.log("[Attribution Core] Initializing client ID");var r=e.client_id||g.get("_trdt_uat_cid",t)||b.get("_trdt_uat_cid",t),s=g.get("_trdt_uat_fv",t)||b.get("_trdt_uat_fv",t);if(o.debug&&console.log("[Attribution Core] Found client ID: ".concat(r,", first visit marker: ").concat(s)),r?(i.clientId=r,i.isFirstVisit=!s,o.debug&&console.log("[Attribution Core] Using existing client ID: ".concat(i.clientId,", isFirstVisit: ").concat(i.isFirstVisit))):(i.clientId=Math.floor(2147483648*Math.random()+0)+"."+a(),i.isFirstVisit=!0,o.debug&&console.log("[Attribution Core] Generated new client ID: ".concat(i.clientId,", isFirstVisit: ").concat(i.isFirstVisit)),t&&(g.set("_trdt_uat_cid",i.clientId,365,t,o.cookieDomain,o.cookieSecure),b.set("_trdt_uat_cid",i.clientId,t))),i.isFirstVisit&&t){var c=u().toString();g.set("_trdt_uat_fv",c,365,t,o.cookieDomain,o.cookieSecure),b.set("_trdt_uat_fv",c,t),o.debug&&console.log("[Attribution Core] Stored first visit marker: ".concat(c))}i.clientId}(c),function(){var e=u(),t=f(i.consentStatus);if(o.debug&&console.log("[Attribution Core] Initializing session"),t){var r=g.get("_trdt_uat_sid",t),n=b.get("_trdt_uat_snum",t),s=g.get("_trdt_uat_last",t);i.isFirstVisit?i.sessionNumber=1:i.sessionNumber=parseInt(n||"1");var a=parseInt(s||"0"),c=e-a>60*o.sessionTimeout;if(o.debug&&console.log("[Attribution Core] Session data - ID: ".concat(r,", Number: ").concat(i.sessionNumber,", Last activity: ").concat(a,", Timeout: ").concat(c)),!r||c){i.sessionId=e,i.isFirstVisit||i.sessionNumber++,i.sessionEngaged=!1,i.isNewVisit=!0,o.debug&&console.log("[Attribution Core] Created new session: ".concat(i.sessionId,", isNewVisit: true"));try{b.set("_trdt_uat_snum",i.sessionNumber.toString(),t),g.set("_trdt_uat_sid",i.sessionId.toString(),0,t,o.cookieDomain,o.cookieSecure),g.set("_trdt_uat_last",e.toString(),0,t,o.cookieDomain,o.cookieSecure)}catch(e){o.debug&&console.error("[Attribution Core] Error storing session data:",e)}}else{i.sessionId=parseInt(r),i.sessionEngaged=!0,i.isNewVisit=!1,o.debug&&console.log("[Attribution Core] Continuing session: ".concat(i.sessionId,", isNewVisit: false"));try{g.set("_trdt_uat_last",e.toString(),0,t,o.cookieDomain,o.cookieSecure)}catch(e){o.debug&&console.error("[Attribution Core] Error updating last activity:",e)}}}else i.sessionId=e,i.sessionNumber=1,i.sessionEngaged=!1,i.isNewVisit=!0,o.debug&&console.log("[Attribution Core] Created ephemeral session: ".concat(i.sessionId,", isNewVisit: true"));i.sessionId}(),t&&i.initializedTargets.add(t),o.initialized||(o.initialized=!0,e._trdt_uat_ready=!0,o.useServiceWorker&&i.consentStatus.analytics&&m.register(o,i,this.processOfflineEvents.bind(this)),setTimeout((function(){return y(s,e,o.debug)}),0)),!1!==c.send_page_view&&setTimeout((function(){r.event("page_view",{send_to:t})}),0),!0},set:function(e,t){var r=this;if("object"===C(e))return Object.entries(e).forEach((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],s=o[1];r.set(i,s)})),!0;t=function(e){var t,r,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return e;if((t=e)&&("[object Function]"===Object.prototype.toString.call(t)||"function"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)))try{e=e()}catch(e){return i&&console.error("Attribution Core: Error evaluating function parameter",e),null}return function(e){return null!=e&&"string"==typeof e}(e)?(n=o,"string"==typeof(r=e)?r.substring(0,n):r):e}(t,100,o.debug);var n=f(i.consentStatus);switch(e){case"user_id":i.userId=t,n&&(g.set("_trdt_uat_uid",t,365,n,o.cookieDomain,o.cookieSecure),b.set("_trdt_uat_uid",t,n));break;case"client_id":i.clientId=t,n&&(g.set("_trdt_uat_cid",t,365,n,o.cookieDomain,o.cookieSecure),b.set("_trdt_uat_cid",t,n));break;case"debug_mode":o.debug=!0===t||"true"===t;break;case"page_referrer":i.persistentParameters.page_referrer=t,o.debug&&console.log("[Attribution Core] Manually set page_referrer: ".concat(t));break;case"page_location":i.persistentParameters.page_location=t,o.debug&&console.log("[Attribution Core] Manually set page_location: ".concat(t));break;case"ignore_referrer":i.ignoreReferrer=!0===t||"true"===t,o.debug&&console.log("[Attribution Core] Manually set ignore_referrer: ".concat(i.ignoreReferrer));break;default:i.persistentParameters[e]=t}return!0},event:function(r){var s=arguments.length>1&&arguments[1]!==n?arguments[1]:{};if(!r)return l("Missing event name"),!1;if(!o.initialized)return h(e,["event",r,s],o.debug),!0;o.debug&&(console.log("[Attribution Core] Processing event: ".concat(r)),console.log("[Attribution Core] Current flags - isFirstVisit: ".concat(i.isFirstVisit,", isNewVisit: ").concat(i.isNewVisit))),i.sessionEngaged||(i.sessionEngaged=!0),s.hasOwnProperty("ignore_referrer")?(i.ignoreReferrer=!0===s.ignore_referrer,delete s.ignore_referrer,o.debug&&console.log("[Attribution Core] Event parameter ignore_referrer set to: ".concat(i.ignoreReferrer))):(i.ignoreReferrer=!1,o.debug&&console.log("[Attribution Core] Reset ignore_referrer to false for new event")),s.hasOwnProperty("page_referrer")&&(i.persistentParameters.page_referrer=s.page_referrer,delete s.page_referrer,o.debug&&console.log("[Attribution Core] Custom page_referrer set: ".concat(i.persistentParameters.page_referrer))),s.hasOwnProperty("page_location")&&(i.persistentParameters.page_location=s.page_location,delete s.page_location,o.debug&&console.log("[Attribution Core] Custom page_location set: ".concat(i.persistentParameters.page_location)));var a=o.attributionIds;if(s.send_to){var c=s.send_to;a=Array.isArray(c)?c:[c],delete s.send_to}var b=a.filter((function(e){return i.initializedTargets.has(e)}));0===b.length&&o.attributionIds.length>0&&b.push(o.attributionIds[0]);var v=i.isFirstVisit,_=i.isNewVisit,p=Object.assign({},s,{event_name:r}),m=d(p,Object.assign({},o,{attributionIds:b}),i,0,t);this.sendEvent(m),!0===v&&(i.isFirstVisit=!1,o.debug&&console.log("[Attribution Core] Reset isFirstVisit flag after event")),!0===_&&(i.isNewVisit=!1,o.debug&&console.log("[Attribution Core] Reset isNewVisit flag after event"));var y=f(i.consentStatus);if(y)try{var S=u();g.set("_trdt_uat_last",S.toString(),0,y,o.cookieDomain,o.cookieSecure)}catch(e){o.debug&&console.error("[Attribution Core] Error updating last activity:",e)}return!0},sendEvent:function(e){o.useServiceWorker&&m.canUseServiceWorker()&&i.consentStatus.analytics?_.sendViaServiceWorker(e,o):_.sendDirectRequest(e,o,this.saveOfflineEvent.bind(this))},saveOfflineEvent:function(e){var t=f(i.consentStatus);S(e,t,o.offlineStorage,o.debug)},processOfflineEvents:function(){var e=f(i.consentStatus);w(o.endpoint,e,o.offlineStorage,o.debug)},consent:function(e,t){if(!t||!t.hasOwnProperty("consent"))return l("Invalid consent parameters"),!1;var r=t.consent,n=Object.assign({},i.consentStatus);if(r.hasOwnProperty("analytics")){var o=!0===r.analytics||"granted"===r.analytics;n.analytics!==o&&(i.consentStatus.analytics=o)}if(r.hasOwnProperty("advertising")){var s=!0===r.advertising||"granted"===r.advertising;n.advertising!==s&&(i.consentStatus.advertising=s)}if(r.hasOwnProperty("personalization")){var a=!0===r.personalization||"granted"===r.personalization;n.personalization!==a&&(i.consentStatus.personalization=a)}return!0},get:function(e,t,r){var n;switch(t){case"client_id":n=i.clientId;break;case"user_id":n=i.userId;break;case"session_id":n=i.sessionId;break;case"consent_status":n=Object.assign({},i.consentStatus);break;case"debug_mode":n=o.debug;break;default:n=i.persistentParameters[t]}return"function"==typeof r&&r(n),n}};e._trdt_uat=Object.assign((function(){var t=Array.from(arguments);if(0===t.length)return e._trdt_uat;if(o.initialized&&"string"==typeof t[0]&&s[t[0]]){var r=t.shift();return s[r].apply(s,t)}return h(e,t,o.debug),!0}),s),e.attrib=e.attrib||function(){return e._trdt_uat.apply(null,arguments)},e._trdt_uat_queue.length>0&&setTimeout((function(){if(!o.initialized)for(var t=0;t<e._trdt_uat_queue.length;t++){var r=e._trdt_uat_queue[t];if("config"===r[0]){e._trdt_uat_queue.splice(t,1),s.config.apply(s,r.slice(1));break}}o.initialized&&y(s,e,o.debug)}),0),void 0!==r&&void 0!==e&&(e.addEventListener("online",(function(){o.initialized&&f(i.consentStatus)&&s.processOfflineEvents()})),r.addEventListener("visibilitychange",(function(){"visible"===r.visibilityState&&o.initialized&&f(i.consentStatus)&&s.processOfflineEvents()})),e.addEventListener("beforeunload",(function(){if("function"==typeof navigator.sendBeacon&&o.initialized)try{e._trdt_uat_queue&&e._trdt_uat_queue.length>0&&e._trdt_uat_queue.forEach((function(e){if("event"===e[0]){var r=e[1],n=e[2]||{},s=Object.assign({},n,{event_name:r});try{var a=d(s,o,i,0,t);_.sendBeacon(a,o)}catch(e){o.debug&&console.error("[Attribution Core] Error processing event:",e)}}}))}catch(e){o.debug&&console.error("[Attribution Core] Error in beforeunload handler:",e)}})))}(window,document),e.default})()));