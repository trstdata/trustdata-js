!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AttributionCore=t():e.AttributionCore=t()}(this,(()=>(()=>{"use strict";var e={};const t=function(){return{page_location:document.location.href,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)}},n=function(e){var t;return"node"===e||"undefined"==typeof window||"undefined"!=typeof window&&!("navigator"in window)?new Promise((function(e){e(null)})):null!==(t=navigator)&&void 0!==t&&null!==(t=t.userAgentData)&&void 0!==t&&t.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model","uaFullVersion","bitness","fullVersionList","wow64"]).then((function(e){var t,n,r;return{user_agent_architecture:e.architecture,user_agent_bitness:e.bitness,user_agent_full_version_list:encodeURIComponent((Object.values(e.fullVersionList)||(null===(t=navigator)||void 0===t||null===(t=t.userAgentData)||void 0===t?void 0:t.brands)).map((function(e){return[e.brand,e.version].join(";")})).join("|")),user_agent_mobile:e.mobile?1:0,user_agent_model:e.model||(null===(n=navigator)||void 0===n||null===(n=n.userAgentData)||void 0===n?void 0:n.mobile),user_agent_platform:e.platform||(null===(r=navigator)||void 0===r||null===(r=r.userAgentData)||void 0===r?void 0:r.platform),user_agent_platform_version:e.platformVersion,user_agent_wow64:e.wow64?1:0}})):new Promise((function(e){e(null)}))};function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var i=function(){return Math.floor(1*new Date/1e3)},a=function(e){if(!e)return"";try{return new URL(e).hostname}catch(e){return console.error("Error parsing URL:",e),""}},s=function(){return i()},c=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,["[Attribution Core]"].concat(n))},u=function(e,t,o,i,a){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n;t.debug&&console.log("[Attribution Core] Creating payload - isFirstVisit: ".concat(o.isFirstVisit,", isNewVisit: ").concat(o.isNewVisit,", ignoreReferrer: ").concat(o.ignoreReferrer));var u={};u.attribution_id=t.attributionIds,u.client_id=o.clientId,null!==o.userId&&void 0!==o.userId&&""!==o.userId&&(u.user_id=o.userId),u.session_id=o.sessionId,u.session_number=o.sessionNumber,u.session_engaged=o.sessionEngaged?1:0,u.event_time=s();var l=o.isFirstVisit;if(!0===o.isNewVisit&&(u.entrances=1,t.debug&&console.log("[Attribution Core] Added entrances=1 to payload")),!0===l&&(u.first_visit=1,t.debug&&console.log("[Attribution Core] Added first_visit=1 to payload")),!0!==o.ignoreReferrer?"undefined"!=typeof document&&(u.page_referrer=document.referrer||"",t.debug&&console.log("[Attribution Core] Added referrer: ".concat(u.page_referrer))):(u.ignore_referrer=!0,u.hasOwnProperty("page_referrer")&&delete u.page_referrer,t.debug&&console.log("[Attribution Core] Set ignore_referrer=true and removed page_referrer")),"undefined"!=typeof window&&window.location)try{var d=new URLSearchParams(window.location.search),g={};["utm_source","utm_medium","utm_campaign","utm_term","utm_content","trdt_cpid","trdt_agid","trdt_kwid","trdt_ctid"].forEach((function(e){var t=d.get(e);t&&(u[e]=t,g[e]=t)})),t.debug&&Object.keys(g).length>0&&console.log("[Attribution Core] Added URL parameters: "+JSON.stringify(g))}catch(e){t.debug&&console.error("[Attribution Core] Error extracting URL parameters:",e)}if("undefined"!=typeof document&&a){var f=a();Object.entries(f).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];u[n]=o})),t.debug&&console.log("[Attribution Core] Added page data: "+JSON.stringify(f))}var v,_=("undefined"!=typeof window&&void 0!==window.document?v="browser":"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node&&(v="node"),v);if("browser"===_){var b=function(){var e={};if("undefined"==typeof navigator)return e;try{if(e.user_agent=navigator.userAgent||"",navigator.userAgentData){var t=navigator.userAgentData.brands;t&&Array.isArray(t)&&(e.user_agent_brands=JSON.stringify(t)),e.user_agent_mobile=navigator.userAgentData.mobile,e.user_agent_platform=navigator.userAgentData.platform}window.screen&&(e.screen_width=window.screen.width,e.screen_height=window.screen.height,e.screen_color_depth=window.screen.colorDepth),window.devicePixelRatio&&(e.device_pixel_ratio=window.devicePixelRatio),e.language=navigator.language||"",e.languages=Array.isArray(navigator.languages)?navigator.languages.join(","):"","undefined"!=typeof Intl&&Intl.DateTimeFormat&&(e.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone||""),e.timezone_offset=(new Date).getTimezoneOffset(),e.java_enabled=!!navigator.javaEnabled&&navigator.javaEnabled(),e.cookies_enabled=navigator.cookieEnabled||!1,navigator.connection&&(e.connection_type=navigator.connection.effectiveType||"",e.connection_downlink=navigator.connection.downlink||"",e.connection_rtt=navigator.connection.rtt||"",e.connection_save_data=navigator.connection.saveData||!1)}catch(e){console.error("Error collecting client hints:",e)}return e}();Object.keys(b).length>0&&(Object.entries(b).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];u[n]=o})),Object.entries(b).forEach((function(e){var t=r(e,2),n=t[0],i=t[1];o.persistentParameters[n]=i})),t.debug&&console.log("[Attribution Core] Added synchronous client hints to payload: "+JSON.stringify(b))),c&&c(_).then((function(e){e&&(Object.entries(e).forEach((function(e){var t=r(e,2),n=t[0],i=t[1];o.persistentParameters[n]=i})),t.debug&&console.log("[Attribution Core] Collected additional client hints for future events: "+JSON.stringify(e)))})).catch((function(e){t.debug&&console.warn("[Attribution Core] Error collecting async client hints:",e)}))}var p={};if(Object.entries(o.persistentParameters).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];u[n]||(u[n]=o,p[n]=o)})),t.debug&&Object.keys(p).length>0&&console.log("[Attribution Core] Added persistent parameters: "+JSON.stringify(p)),u.consent_analytics=o.consentStatus.analytics,u.consent_advertising=o.consentStatus.advertising,u.consent_personalization=o.consentStatus.personalization,e){e.event_name&&(u.event_name=e.event_name,delete e.event_name,t.debug&&console.log("[Attribution Core] Added event name to payload: "+u.event_name));var m={};Object.entries(e).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];u[n]=o,m[n]=o})),t.debug&&Object.keys(m).length>0&&console.log("[Attribution Core] Added event-specific data to payload: "+JSON.stringify(m))}return u};const l={canUseStorage:function(e){return!0===e.analytics},cookies:{get:function(e,t){if(!t||"undefined"==typeof document)return null;for(var n=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return decodeURIComponent(i.substring(n.length,i.length))}return null},set:function(e,t,n,r,o,i){if(r&&"undefined"!=typeof document){var a="";if(n){var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),a="; expires="+s.toUTCString()}var c=o?"; domain="+o:"",u=i?"; Secure":"";document.cookie=e+"="+encodeURIComponent(t)+a+c+"; path=/; SameSite=Lax"+u}},remove:function(e,t,n){if(t&&"undefined"!=typeof document){var r=n?"; domain="+n:"";document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"+r+"; SameSite=Lax"}}},local:{get:function(e,t,n){if(!t)return null;try{return localStorage.getItem(e)}catch(e){return n&&console.warn("[Attribution Core] localStorage access error",e),null}},set:function(e,t,n,r){if(n)try{localStorage.setItem(e,t)}catch(e){r&&console.warn("[Attribution Core] localStorage set error",e)}},remove:function(e,t,n){if(t)try{localStorage.removeItem(e)}catch(e){n&&console.warn("[Attribution Core] localStorage remove error",e)}}},clearAllTracking:function(e){e&&(this.cookies.remove("_trdt_uat_cid",!0),this.cookies.remove("_trdt_uat_sid",!0),this.cookies.remove("_trdt_uat_last",!0),this.cookies.remove("_trdt_uat_fv",!0),this.local.remove("_trdt_uat_cid",!0,!1),this.local.remove("_trdt_uat_snum",!0,!1),this.local.remove("_trdt_uat_uid",!0,!1),this.local.remove("_trdt_uat_offline",!0,!1),this.local.remove("_trdt_uat_fv",!0,!1))}};var d={sendDirectRequest:function(e,t,n){t.attributionIds.forEach((function(r){var o=Object.assign({},e);if(o.attribution_id=r,"undefined"!=typeof fetch)fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),keepalive:!0}).catch((function(e){console.error("[Attribution Core] Failed to send event:",e),n(o)}));else{var i=new XMLHttpRequest;i.open("POST",t.endpoint,!0),i.setRequestHeader("Content-Type","application/json"),i.timeout=1e4,i.onreadystatechange=function(){4===i.readyState&&(i.status<200||i.status>=300)&&(console.error("[Attribution Core] Failed to send event, status:",i.status),n(o))},i.onerror=function(){console.error("[Attribution Core] XHR error when sending event"),n(o)},i.send(JSON.stringify(o))}}))},sendViaServiceWorker:function(e,t){var n="msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));navigator.serviceWorker.controller.postMessage({action:"recordEvent",endpoint:t.endpoint,payload:e,messageId:n,timestamp:Date.now()})},sendBeacon:function(e,t){t.attributionIds.forEach((function(n){var r=Object.assign({},e);r.attribution_id=n,navigator.sendBeacon(t.endpoint,new Blob([JSON.stringify(r)],{type:"application/json"}))}))}};const g=d;var f={register:function(e,t,n){if(!e.useServiceWorker||!t.consentStatus.analytics||void 0===navigator.serviceWorker)return!1;try{navigator.serviceWorker.register(e.swPath).then((function(t){e.debug&&console.log("[Attribution Core] Service Worker registered:",t),window.addEventListener("online",(function(){e.debug&&console.log("[Attribution Core] Online - processing offline events"),n()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&(e.debug&&console.log("[Attribution Core] Page visible - processing offline events"),n())}))})).catch((function(e){console.error("[Attribution Core] Service Worker registration failed:",e)}))}catch(e){return console.error("[Attribution Core] Error registering Service Worker:",e),!1}return!0},canUseServiceWorker:function(){return"undefined"!=typeof navigator&&void 0!==navigator.serviceWorker&&null!==navigator.serviceWorker.controller},unregister:function(){return void 0===navigator.serviceWorker?Promise.resolve(!1):navigator.serviceWorker.getRegistrations().then((function(e){var t=e.map((function(e){return e.unregister()}));return Promise.all(t)})).catch((function(e){return console.error("[Attribution Core] Error unregistering Service Workers:",e),!1}))}};const v=f,_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t._trdt_uat_queue&&t._trdt_uat_queue.length){n&&console.log("[Attribution Core] Processing",t._trdt_uat_queue.length,"queued commands");var r={consent:1,config:2,set:3,event:4,get:5},o=t._trdt_uat_queue.slice();t._trdt_uat_queue=[],o.sort((function(e,t){return(r[e[0]]||999)-(r[t[0]]||999)})),n&&console.log("[Attribution Core] Commands sorted by priority:",o.map((function(e){return e[0]}))),o.forEach((function(t){try{var r=t[0],o=t.slice(1);n&&console.log("[Attribution Core] Processing command:",r),e[r]?e[r].apply(e,o):n&&console.warn("[Attribution Core] Unknown command:",r)}catch(e){n&&console.error("[Attribution Core] Error processing command:",e)}})),n&&console.log("[Attribution Core] Queue processing complete")}},b=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._trdt_uat_queue=e._trdt_uat_queue||[],e._trdt_uat_queue.push(t),n&&t&&t.length>0&&console.log("[Attribution Core] Added to queue:",t[0]),!0},p=function(e,t,n,r){if(t&&n)try{var o=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");o.push({payload:e,timestamp:Date.now()}),localStorage.setItem("_trdt_uat_offline",JSON.stringify(o)),r&&console.log("[Attribution Core] Saved event for offline processing")}catch(e){console.error("[Attribution Core] Failed to save event for offline processing",e)}},m=function(e,t,n,r){if(t&&n)try{var o=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");if(0===o.length)return;r&&console.log("[Attribution Core] Processing ".concat(o.length," offline events"));var i=[];o.forEach((function(t){try{fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload),keepalive:!0}).catch((function(){i.push(t)}))}catch(e){i.push(t)}})),localStorage.setItem("_trdt_uat_offline",JSON.stringify(i)),r&&console.log("[Attribution Core] Processed offline events, ".concat(i.length," remaining"))}catch(e){console.error("[Attribution Core] Error processing offline events",e)}};function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}return function(e,n,r){e._trdt_uat_ready=!1,e._trdt_uat=e._trdt_uat||{},e._trdt_uat_queue=e._trdt_uat_queue||[];var o={version:"2.0.1",debug:!1,endpoint:"https://t.trstdata.com/api/events",swPath:"https://cdn.jsdelivr.net/gh/trstdata/trustdata-js@main/dist/v1/core-sw-v1.js",useServiceWorker:"serviceWorker"in navigator,offlineStorage:!0,sessionTimeout:30,initialized:!1,attributionIds:[],cookieDomain:"",cookieSecure:!0},d={clientId:null,userId:null,sessionId:null,sessionNumber:0,sessionEngaged:!1,isNewVisit:!1,isFirstVisit:!1,ignoreReferrer:!1,consentStatus:{analytics:!1,advertising:!1,personalization:!1},persistentParameters:{},initializedTargets:new Set},f={config:function(t){var n=this,a=arguments.length>1&&arguments[1]!==r?arguments[1]:{};return t&&!o.attributionIds.includes(t)&&o.attributionIds.push(t),Object.assign(o,a),a.consent&&this.consent("update",{consent:a.consent}),function(){var e=arguments.length>0&&arguments[0]!==r?arguments[0]:{},t=l.canUseStorage(d.consentStatus);o.debug&&console.log("[Attribution Core] Initializing client ID");var n=e.client_id||l.cookies.get("_trdt_uat_cid",t)||l.local.get("_trdt_uat_cid",t),a=l.cookies.get("_trdt_uat_fv",t)||l.local.get("_trdt_uat_fv",t);if(o.debug&&console.log("[Attribution Core] Found client ID: ".concat(n,", first visit marker: ").concat(a)),n?(d.clientId=n,d.isFirstVisit=!a,o.debug&&console.log("[Attribution Core] Using existing client ID: ".concat(d.clientId,", isFirstVisit: ").concat(d.isFirstVisit))):(d.clientId=Math.floor(2147483648*Math.random()+0)+"."+i(),d.isFirstVisit=!0,o.debug&&console.log("[Attribution Core] Generated new client ID: ".concat(d.clientId,", isFirstVisit: ").concat(d.isFirstVisit)),t&&(l.cookies.set("_trdt_uat_cid",d.clientId,365,t,o.cookieDomain,o.cookieSecure),l.local.set("_trdt_uat_cid",d.clientId,t))),d.isFirstVisit&&t){var c=s().toString();l.cookies.set("_trdt_uat_fv",c,365,t,o.cookieDomain,o.cookieSecure),l.local.set("_trdt_uat_fv",c,t),o.debug&&console.log("[Attribution Core] Stored first visit marker: ".concat(c))}d.clientId}(a),function(){var e=s(),t=l.canUseStorage(d.consentStatus);if(o.debug&&console.log("[Attribution Core] Initializing session"),t){var n=l.cookies.get("_trdt_uat_sid",t),r=l.local.get("_trdt_uat_snum",t),i=l.cookies.get("_trdt_uat_last",t);d.isFirstVisit?d.sessionNumber=1:d.sessionNumber=parseInt(r||"1");var a=parseInt(i||"0"),c=e-a>60*o.sessionTimeout;if(o.debug&&console.log("[Attribution Core] Session data - ID: ".concat(n,", Number: ").concat(d.sessionNumber,", Last activity: ").concat(a,", Timeout: ").concat(c)),!n||c){d.sessionId=e,d.isFirstVisit||d.sessionNumber++,d.sessionEngaged=!1,d.isNewVisit=!0,o.debug&&console.log("[Attribution Core] Created new session: ".concat(d.sessionId,", isNewVisit: true"));try{l.local.set("_trdt_uat_snum",d.sessionNumber.toString(),t),l.cookies.set("_trdt_uat_sid",d.sessionId.toString(),0,t,o.cookieDomain,o.cookieSecure),l.cookies.set("_trdt_uat_last",e.toString(),0,t,o.cookieDomain,o.cookieSecure)}catch(e){o.debug&&console.error("[Attribution Core] Error storing session data:",e)}}else{d.sessionId=parseInt(n),d.sessionEngaged=!0,d.isNewVisit=!1,o.debug&&console.log("[Attribution Core] Continuing session: ".concat(d.sessionId,", isNewVisit: false"));try{l.cookies.set("_trdt_uat_last",e.toString(),0,t,o.cookieDomain,o.cookieSecure)}catch(e){o.debug&&console.error("[Attribution Core] Error updating last activity:",e)}}}else d.sessionId=e,d.sessionNumber=1,d.sessionEngaged=!1,d.isNewVisit=!0,o.debug&&console.log("[Attribution Core] Created ephemeral session: ".concat(d.sessionId,", isNewVisit: true"));d.sessionId}(),t&&d.initializedTargets.add(t),o.initialized||(o.initialized=!0,e._trdt_uat_ready=!0,o.useServiceWorker&&d.consentStatus.analytics&&v.register(o,d,this.processOfflineEvents.bind(this)),setTimeout((function(){return _(f,e,o.debug)}),0)),!1!==a.send_page_view&&setTimeout((function(){n.event("page_view",{send_to:t})}),0),!0},set:function(e,t){var n=this;if("object"===y(e))return Object.entries(e).forEach((function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,r)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];n.set(i,a)})),!0;t=function(e){var t,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return e;if((t=e)&&("[object Function]"===Object.prototype.toString.call(t)||"function"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)))try{e=e()}catch(e){return i&&console.error("Attribution Core: Error evaluating function parameter",e),null}return function(e){return null!=e&&"string"==typeof e}(e)?(r=o,"string"==typeof(n=e)?n.substring(0,r):n):e}(t,100,o.debug);var r=l.canUseStorage(d.consentStatus);switch(e){case"user_id":d.userId=t,r&&(l.cookies.set("_trdt_uat_uid",t,365,r,o.cookieDomain,o.cookieSecure),l.local.set("_trdt_uat_uid",t,r));break;case"client_id":d.clientId=t,r&&(l.cookies.set("_trdt_uat_cid",t,365,r,o.cookieDomain,o.cookieSecure),l.local.set("_trdt_uat_cid",t,r));break;case"debug_mode":o.debug=!0===t||"true"===t;break;default:d.persistentParameters[e]=t}return!0},event:function(i){var g=arguments.length>1&&arguments[1]!==r?arguments[1]:{};if(!i)return c("Missing event name"),!1;if(!o.initialized)return b(e,["event",i,g],o.debug),!0;if(o.debug&&(console.log("[Attribution Core] Processing event: ".concat(i)),console.log("[Attribution Core] Current flags - isFirstVisit: ".concat(d.isFirstVisit,", isNewVisit: ").concat(d.isNewVisit))),d.sessionEngaged||(d.sessionEngaged=!0),g.hasOwnProperty("ignore_referrer"))d.ignoreReferrer=!0===g.ignore_referrer,delete g.ignore_referrer,o.debug&&console.log("[Attribution Core] Manual ignore_referrer set to: ".concat(d.ignoreReferrer));else if(d.ignoreReferrer=!1,void 0!==n&&n.referrer)try{var f=a(n.referrer),v=a(n.location.href);f&&v&&f===v&&(d.ignoreReferrer=!0,o.debug&&console.log("[Attribution Core] Ignoring same-domain referrer: ".concat(f)))}catch(e){o.debug&&console.error("[Attribution Core] Error comparing domains:",e)}var _=o.attributionIds;if(g.send_to){var p=g.send_to;_=Array.isArray(p)?p:[p],delete g.send_to}var m=_.filter((function(e){return d.initializedTargets.has(e)}));0===m.length&&o.attributionIds.length>0&&m.push(o.attributionIds[0]);var h=d.isFirstVisit,y=d.isNewVisit,S=Object.assign({},g,{event_name:i}),w=u(S,Object.assign({},o,{attributionIds:m}),d,l,t);this.sendEvent(w),!0===h&&(d.isFirstVisit=!1,o.debug&&console.log("[Attribution Core] Reset isFirstVisit flag after event")),!0===y&&(d.isNewVisit=!1,o.debug&&console.log("[Attribution Core] Reset isNewVisit flag after event"));var A=l.canUseStorage(d.consentStatus);if(A)try{var k=s();l.cookies.set("_trdt_uat_last",k.toString(),0,A,o.cookieDomain,o.cookieSecure)}catch(e){o.debug&&console.error("[Attribution Core] Error updating last activity:",e)}return!0},sendEvent:function(e){o.useServiceWorker&&v.canUseServiceWorker()&&d.consentStatus.analytics?g.sendViaServiceWorker(e,o):g.sendDirectRequest(e,o,this.saveOfflineEvent.bind(this))},saveOfflineEvent:function(e){var t=l.canUseStorage(d.consentStatus);p(e,t,o.offlineStorage,o.debug)},processOfflineEvents:function(){var e=l.canUseStorage(d.consentStatus);m(o.endpoint,e,o.offlineStorage,o.debug)},consent:function(e,t){if(!t||!t.hasOwnProperty("consent"))return c("Invalid consent parameters"),!1;var n=t.consent,r=Object.assign({},d.consentStatus);if(n.hasOwnProperty("analytics")){var o=!0===n.analytics||"granted"===n.analytics;r.analytics!==o&&(d.consentStatus.analytics=o)}if(n.hasOwnProperty("advertising")){var i=!0===n.advertising||"granted"===n.advertising;r.advertising!==i&&(d.consentStatus.advertising=i)}if(n.hasOwnProperty("personalization")){var a=!0===n.personalization||"granted"===n.personalization;r.personalization!==a&&(d.consentStatus.personalization=a)}return!0},get:function(e,t,n){var r;switch(t){case"client_id":r=d.clientId;break;case"user_id":r=d.userId;break;case"session_id":r=d.sessionId;break;case"consent_status":r=Object.assign({},d.consentStatus);break;case"debug_mode":r=o.debug;break;default:r=d.persistentParameters[t]}return"function"==typeof n&&n(r),r}};e._trdt_uat=Object.assign((function(){var t=Array.from(arguments);if(0===t.length)return e._trdt_uat;if(o.initialized&&"string"==typeof t[0]&&f[t[0]]){var n=t.shift();return f[n].apply(f,t)}return b(e,t,o.debug),!0}),f),e.attrib=e.attrib||function(){return e._trdt_uat.apply(null,arguments)},e._trdt_uat_queue.length>0&&setTimeout((function(){if(!o.initialized)for(var t=0;t<e._trdt_uat_queue.length;t++){var n=e._trdt_uat_queue[t];if("config"===n[0]){e._trdt_uat_queue.splice(t,1),f.config.apply(f,n.slice(1));break}}o.initialized&&_(f,e,o.debug)}),0),void 0!==n&&void 0!==e&&(e.addEventListener("online",(function(){o.initialized&&l.canUseStorage(d.consentStatus)&&f.processOfflineEvents()})),n.addEventListener("visibilitychange",(function(){"visible"===n.visibilityState&&o.initialized&&l.canUseStorage(d.consentStatus)&&f.processOfflineEvents()})),e.addEventListener("beforeunload",(function(){if("function"==typeof navigator.sendBeacon&&o.initialized)try{e._trdt_uat_queue&&e._trdt_uat_queue.length>0&&e._trdt_uat_queue.forEach((function(e){if("event"===e[0]){var n=e[1],r=e[2]||{},i=Object.assign({},r,{event_name:n});try{var a=u(i,o,d,l,t);g.sendBeacon(a,o)}catch(e){o.debug&&console.error("[Attribution Core] Error processing event:",e)}}}))}catch(e){o.debug&&console.error("[Attribution Core] Error in beforeunload handler:",e)}})))}(window,document),e.default})()));