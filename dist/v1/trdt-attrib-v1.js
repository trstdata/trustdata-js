!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AttributionCore=t():e.AttributionCore=t()}(this,(()=>(()=>{"use strict";var e={};const t=function(){return{page_location:document.location.href,page_referrer:document.referrer,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)}},n=function(e){var t;return"node"===e||"undefined"==typeof window||"undefined"!=typeof window&&!("navigator"in window)?new Promise((function(e){e(null)})):null!==(t=navigator)&&void 0!==t&&null!==(t=t.userAgentData)&&void 0!==t&&t.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model","uaFullVersion","bitness","fullVersionList","wow64"]).then((function(e){var t,n,r;return{user_agent_architecture:e.architecture,user_agent_bitness:e.bitness,user_agent_full_version_list:encodeURIComponent((Object.values(e.fullVersionList)||(null===(t=navigator)||void 0===t||null===(t=t.userAgentData)||void 0===t?void 0:t.brands)).map((function(e){return[e.brand,e.version].join(";")})).join("|")),user_agent_mobile:e.mobile?1:0,user_agent_model:e.model||(null===(n=navigator)||void 0===n||null===(n=n.userAgentData)||void 0===n?void 0:n.mobile),user_agent_platform:e.platform||(null===(r=navigator)||void 0===r||null===(r=r.userAgentData)||void 0===r?void 0:r.platform),user_agent_platform_version:e.platformVersion,user_agent_wow64:e.wow64?1:0}})):new Promise((function(e){e(null)}))};function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return(t=function(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}var c=function(){return Math.floor(1*new Date/1e3)},d=function(){var e;return"undefined"!=typeof window&&void 0!==window.document?e="browser":"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node&&(e="node"),e},l=function(){return c()},g=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){for(var t,n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];(t=console).log.apply(t,["[Attribution Core]",e].concat(r))}},f=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&console.log("[Attribution Core DEBUG] ".concat(e," - Current STATE:"),{clientId:t.clientId,userId:t.userId,sessionId:t.sessionId,sessionNumber:t.sessionNumber,sessionEngaged:t.sessionEngaged,hitCount:t.hitCount,consentStatus:s({},t.consentStatus)})},b=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).error.apply(e,["[Attribution Core]"].concat(n))},_=function(e,t,n,i,o,s){t.debug&&(g("=== SERIALIZING EVENT ===",t.debug),f("SERIALIZE EVENT - START",n,t.debug));var a={};if(a.attribution_id=t.attributionIds,a.client_id=n.clientId,a.user_id=n.userId,a.session_id=n.sessionId,a.session_number=n.sessionNumber,a.session_engaged=n.sessionEngaged?1:0,a.hit_count=n.hitCount,a.event_time=l(),t.debug&&(g("Basic payload data:",t.debug),g("- attribution_id: "+a.attribution_id,t.debug),g("- client_id: "+a.client_id,t.debug),g("- user_id: "+a.user_id,t.debug),g("- session_id: "+a.session_id,t.debug),g("- session_number: "+a.session_number,t.debug),g("- session_engaged: "+a.session_engaged,t.debug),g("- hit_count: "+a.hit_count,t.debug),g("- event_time: "+a.event_time,t.debug),i.canUseStorage(n.consentStatus))){var u=i.cookies.get("_trdt_uat_cid",!0),c=i.cookies.get("_trdt_uat_sid",!0),b=i.local.get("_trdt_uat_uid",!0,t.debug);g("Storage verification:",t.debug),g("- client_id in cookie: "+u,t.debug),g("- client_id in STATE: "+n.clientId,t.debug),g("- client_id match? "+(u===n.clientId.toString()),t.debug),g("- session_id in cookie: "+c,t.debug),g("- session_id in STATE: "+n.sessionId,t.debug),g("- session_id match? "+(c===n.sessionId.toString()),t.debug),g("- user_id in localStorage: "+b,t.debug),g("- user_id in STATE: "+n.userId,t.debug),g("- user_id match? "+(b===n.userId),t.debug)}if("undefined"!=typeof document&&o){var _=o();Object.entries(_).forEach((function(e){var t=r(e,2),n=t[0],i=t[1];a[n]=i})),t.debug&&g("Added page data: "+JSON.stringify(_),t.debug)}var v=d();if("browser"===v&&s){s(v).then((function(e){e&&(Object.entries(e).forEach((function(e){var t=r(e,2),i=t[0],o=t[1];n.persistentParameters[i]=o})),t.debug&&g("Collected client hints for future events: "+JSON.stringify(e),t.debug))})).catch((function(e){t.debug&&console.warn("[Attribution Core] Error collecting client hints:",e)}));var m={};["user_agent_architecture","user_agent_bitness","user_agent_full_version_list","user_agent_mobile","user_agent_model","user_agent_platform","user_agent_platform_version","user_agent_wow64"].forEach((function(e){n.persistentParameters[e]&&(a[e]=n.persistentParameters[e],m[e]=n.persistentParameters[e])})),t.debug&&Object.keys(m).length>0&&g("Added existing client hints to payload: "+JSON.stringify(m),t.debug)}var p={};if(Object.entries(n.persistentParameters).forEach((function(e){var t=r(e,2),n=t[0],i=t[1];a[n]||(a[n]=i,p[n]=i)})),t.debug&&Object.keys(p).length>0&&g("Added persistent parameters to payload: "+JSON.stringify(p),t.debug),a.consent_analytics=n.consentStatus.analytics,a.consent_advertising=n.consentStatus.advertising,a.consent_personalization=n.consentStatus.personalization,t.debug&&(g("Added consent data:",t.debug),g("- analytics: "+a.consent_analytics,t.debug),g("- advertising: "+a.consent_advertising,t.debug),g("- personalization: "+a.consent_personalization,t.debug)),e){e.event_name&&(a.event_name=e.event_name,delete e.event_name,t.debug&&g("Added event name to payload: "+a.event_name,t.debug));var y={};Object.entries(e).forEach((function(e){var t=r(e,2),n=t[0],i=t[1];a[n]=i,y[n]=i})),t.debug&&Object.keys(y).length>0&&g("Added event-specific data to payload: "+JSON.stringify(y),t.debug)}return t.debug&&(g("=== EVENT SERIALIZATION COMPLETE ===",t.debug),g("Final payload: "+JSON.stringify(a),t.debug),f("SERIALIZE EVENT - COMPLETE",n,t.debug)),a};const v={canUseStorage:function(e){return!0===e.analytics},cookies:{get:function(e,t){if(!t||"undefined"==typeof document)return null;for(var n=e+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(var o=r[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(n))return decodeURIComponent(o.substring(n.length,o.length))}return null},set:function(e,t,n,r){if(r&&"undefined"!=typeof document){var i="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i="; expires="+o.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+i+"; path=/; SameSite=Lax"}},remove:function(e,t){t&&"undefined"!=typeof document&&(document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax")}},local:{get:function(e,t,n){if(!t)return null;try{return localStorage.getItem(e)}catch(e){return n&&console.warn("[Attribution Core] localStorage access error",e),null}},set:function(e,t,n,r){if(n)try{localStorage.setItem(e,t)}catch(e){r&&console.warn("[Attribution Core] localStorage set error",e)}},remove:function(e,t,n){if(t)try{localStorage.removeItem(e)}catch(e){n&&console.warn("[Attribution Core] localStorage remove error",e)}}},clearAllTracking:function(e){e&&(this.cookies.remove("_trdt_uat_cid",!0),this.cookies.remove("_trdt_uat_sid",!0),this.cookies.remove("_trdt_uat_last",!0),this.local.remove("_trdt_uat_cid",!0,!1),this.local.remove("_trdt_uat_snum",!0,!1),this.local.remove("_trdt_uat_uid",!0,!1),this.local.remove("_trdt_uat_offline",!0,!1))}};var m={sendDirectRequest:function(e,t,n){t.attributionIds.forEach((function(r){var i=Object.assign({},e);if(i.attribution_id=r,"undefined"!=typeof fetch)fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),keepalive:!0}).catch((function(e){console.error("[Attribution Core] Failed to send event:",e),n(i)}));else{var o=new XMLHttpRequest;o.open("POST",t.endpoint,!0),o.setRequestHeader("Content-Type","application/json"),o.timeout=1e4,o.onreadystatechange=function(){4===o.readyState&&(o.status<200||o.status>=300)&&(console.error("[Attribution Core] Failed to send event, status:",o.status),n(i))},o.onerror=function(){console.error("[Attribution Core] XHR error when sending event"),n(i)},o.send(JSON.stringify(i))}}))},sendViaServiceWorker:function(e,t){var n="msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));navigator.serviceWorker.controller.postMessage({action:"recordEvent",endpoint:t.endpoint,payload:e,messageId:n,timestamp:Date.now()})},sendBeacon:function(e,t){t.attributionIds.forEach((function(n){var r=Object.assign({},e);r.attribution_id=n,navigator.sendBeacon(t.endpoint,new Blob([JSON.stringify(r)],{type:"application/json"}))}))}};const p=m;var y={register:function(e,t,n){if(!e.useServiceWorker||!t.consentStatus.analytics||void 0===navigator.serviceWorker)return!1;try{navigator.serviceWorker.register(e.swPath).then((function(t){e.debug&&console.log("[Attribution Core] Service Worker registered:",t),window.addEventListener("online",(function(){e.debug&&console.log("[Attribution Core] Online - processing offline events"),n()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&(e.debug&&console.log("[Attribution Core] Page visible - processing offline events"),n())}))})).catch((function(e){console.error("[Attribution Core] Service Worker registration failed:",e)}))}catch(e){return console.error("[Attribution Core] Error registering Service Worker:",e),!1}return!0},canUseServiceWorker:function(){return"undefined"!=typeof navigator&&void 0!==navigator.serviceWorker&&null!==navigator.serviceWorker.controller},unregister:function(){return void 0===navigator.serviceWorker?Promise.resolve(!1):navigator.serviceWorker.getRegistrations().then((function(e){var t=e.map((function(e){return e.unregister()}));return Promise.all(t)})).catch((function(e){return console.error("[Attribution Core] Error unregistering Service Workers:",e),!1}))}};const h=y;function S(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const E=function(e,t,n){if(n._trdt_uat_ready){var r=e.queue.slice();if(e.queue=[],r.length>0&&n._trdt_uat.get("debug_mode")&&console.log("[Attribution Core] Processing",r.length,"queued commands from local queue"),r.forEach((function(e){var n=e.shift();t.apply(void 0,[n].concat(S(e)))})),n._trdt_uat_queue&&Array.isArray(n._trdt_uat_queue)){var i=n._trdt_uat_queue.slice();n._trdt_uat_queue=[],i.length>0&&n._trdt_uat.get("debug_mode")&&console.log("[Attribution Core] Processing",i.length,"queued commands from global queue"),i.forEach((function(e){if(Array.isArray(e)){var n=e.shift();t.apply(void 0,[n].concat(S(e)))}}))}}},A=function(e,t,n){if(e._trdt_uat_queue&&e._trdt_uat_queue.length>0){n&&console.log("[Attribution Core] Found existing queue with",e._trdt_uat_queue.length,"commands");for(var r=0;r<e._trdt_uat_queue.length;r++){var i=e._trdt_uat_queue[r];if("init"===i[0])return e._trdt_uat_queue.splice(r,1),n&&console.log("[Attribution Core] Found and processing init command from queue"),t.apply(void 0,S(i)),!0}}return!1},O=function(e,t){return e.queue||(e.queue=[]),e.queue.push(t),!0},w=function(e,t){return e._trdt_uat_queue=e._trdt_uat_queue||[],e._trdt_uat_queue.push(t),!0},k=function(e,t,n,r){if(t&&n)try{var i=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");i.push({payload:e,timestamp:Date.now()}),localStorage.setItem("_trdt_uat_offline",JSON.stringify(i)),r&&console.log("[Attribution Core] Saved event for offline processing")}catch(e){console.error("[Attribution Core] Failed to save event for offline processing",e)}},T=function(e,t,n,r){if(t&&n)try{var i=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");if(0===i.length)return;r&&console.log("[Attribution Core] Processing ".concat(i.length," offline events"));var o=[];i.forEach((function(t){try{fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload),keepalive:!0}).catch((function(){o.push(t)}))}catch(e){o.push(t)}})),localStorage.setItem("_trdt_uat_offline",JSON.stringify(o)),r&&console.log("[Attribution Core] Processed offline events, ".concat(o.length," remaining"))}catch(e){console.error("[Attribution Core] Error processing offline events",e)}};function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}return function(e,r,i){e._trdt_uat_ready=!1,e._trdt_uat=e._trdt_uat||{},e._trdt_uat_queue=e._trdt_uat_queue||[];var o={version:"1.1.3",debug:!1,endpoint:"https://t.trstdata.com/api/events",swPath:"https://cdn.jsdelivr.net/gh/trstdata/trustdata-js@main/dist/v1/core-sw-v1.js",useServiceWorker:"serviceWorker"in navigator,offlineStorage:!0,sessionTimeout:30,initialized:!1,attributionIds:null,instance:null,cookieDomain:"",cookieSecure:!0},s={clientId:null,userId:null,sessionId:null,sessionNumber:1,sessionEngaged:!1,hitCount:0,consentStatus:{analytics:!1,advertising:!1,personalization:!1},persistentParameters:{},queue:[]},a={init:function(t){var r=this,a=arguments.length>1&&arguments[1]!==i?arguments[1]:{};if(!t)return b("Initialization failed: Missing attribution IDs"),!1;if(o.attributionIds=Array.isArray(t)?t:[t],Object.assign(o,a),a.consent&&(s.consentStatus=a.consent,o.debug&&g("Applied initial consent from config:",o.debug,s.consentStatus)),o.debug&&g("Initializing with IDs:",o.debug,o.attributionIds),o.initialized&&s.clientId)return o.debug&&g("Script already initialized, using existing state",o.debug),e._trdt_uat_ready&&e._trdt_uat_queue&&e._trdt_uat_queue.length>0&&setTimeout((function(){E(s,r.command.bind(r),e)}),0),!0;var u=v.canUseStorage(s.consentStatus),l=a.client_id||v.cookies.get("_trdt_uat_cid",u)||v.local.get("_trdt_uat_cid",u,o.debug);l?(s.clientId=l,o.debug&&g("Using existing client ID:",o.debug,s.clientId)):(s.clientId=Math.floor(2147483648*Math.random()+0)+"."+c(),o.debug&&g("Generated new client ID:",o.debug,s.clientId),u&&(v.cookies.set("_trdt_uat_cid",s.clientId,365,u,o.cookieDomain,o.cookieSecure),v.local.set("_trdt_uat_cid",s.clientId,u,o.debug)));var _=a.user_id||v.local.get("_trdt_uat_uid",u,o.debug);o.debug&&g("Existing user ID from storage:",o.debug,_),_&&(s.userId=_,o.debug&&g("Loaded existing user ID:",o.debug,s.userId)),f("INIT - BEFORE SESSION INIT",s,o.debug),this.initSession(),f("INIT - AFTER SESSION INIT",s,o.debug),o.initialized=!0;var m=d();return"browser"===m&&n(m).then((function(e){e&&(Object.entries(e).forEach((function(e){var t=j(e,2),n=t[0],r=t[1];s.persistentParameters[n]=r})),o.debug&&g("Collected client hints:",o.debug,e))})).catch((function(e){o.debug&&console.warn("[Attribution Core] Error collecting client hints:",e)})),o.useServiceWorker&&s.consentStatus.analytics&&h.register(o,s,this.processOfflineEvents.bind(this)),setTimeout((function(){if(o.debug){var t=v.cookies.get("_trdt_uat_cid",u),n=v.cookies.get("_trdt_uat_sid",u);g("Storage verification after initialization:",o.debug),g("- client_id in cookie: "+t,o.debug),g("- client_id in STATE: "+s.clientId,o.debug),g("- client_id match? "+(t===s.clientId.toString()),o.debug),g("- session_id in cookie: "+n,o.debug),g("- session_id in STATE: "+s.sessionId,o.debug),g("- session_id match? "+(n===s.sessionId.toString()),o.debug)}e._trdt_uat_ready=!0,E(s,r.command.bind(r),e),f("INIT - COMPLETE",s,o.debug),g("=== INITIALIZATION COMPLETED ===",o.debug)}),100),!0},initSession:function(){g("=== SESSION INITIALIZATION STARTED ===",o.debug);var e=l(),t=v.canUseStorage(s.consentStatus);if(o.debug&&(g("Current timestamp:",o.debug,e),g("Can use storage:",o.debug,t)),t){var n=v.cookies.get("_trdt_uat_sid",t),r=v.local.get("_trdt_uat_snum",t,o.debug),i=v.cookies.get("_trdt_uat_last",t);o.debug&&(g("Stored session ID from cookie:",o.debug,n),g("Stored session number from localStorage:",o.debug,r),g("Last activity timestamp from cookie:",o.debug,i)),s.sessionNumber=parseInt(r||"1");var a=parseInt(i||"0"),u=e-a>60*o.sessionTimeout;if(o.debug&&(g("Parsed session number:",o.debug,s.sessionNumber),g("Parsed last activity:",o.debug,a),g("Session timeout (in seconds):",o.debug,60*o.sessionTimeout),g("Time since last activity (in seconds):",o.debug,e-a),g("Session timed out?",o.debug,u)),!n||u){s.sessionId=e,s.sessionNumber++,s.sessionEngaged=!1,o.debug&&(g("Creating new session with timestamp:",o.debug,s.sessionId),g("New session number:",o.debug,s.sessionNumber),g(n?"Reason: Session timeout":"Reason: No previous session ID found",o.debug));try{if(v.local.set("_trdt_uat_snum",s.sessionNumber.toString(),t,o.debug),v.cookies.set("_trdt_uat_sid",s.sessionId.toString(),0,t,o.cookieDomain,o.cookieSecure),v.cookies.set("_trdt_uat_last",e.toString(),0,t,o.cookieDomain,o.cookieSecure),o.debug){var c=v.cookies.get("_trdt_uat_sid",t),d=v.local.get("_trdt_uat_snum",t,o.debug),_=v.cookies.get("_trdt_uat_last",t);g("Verification - Session ID stored in cookie:",o.debug,c),g("Verification - Session number stored in localStorage:",o.debug,d),g("Verification - Last activity stored in cookie:",o.debug,_)}}catch(e){b("Error storing session data:",e)}}else{s.sessionId=parseInt(n),s.sessionEngaged=!0,o.debug&&g("Continuing existing session with ID:",o.debug,s.sessionId);try{if(v.cookies.set("_trdt_uat_last",e.toString(),0,t,o.cookieDomain,o.cookieSecure),o.debug){var m=v.cookies.get("_trdt_uat_last",t);g("Verification - Updated last activity in cookie:",o.debug,m)}}catch(e){b("Error updating last activity:",e)}}}else s.sessionId=e,s.sessionNumber=1,s.sessionEngaged=!1,o.debug&&g("Created ephemeral session (no storage consent) with ID:",o.debug,s.sessionId);f("SESSION INIT - COMPLETE",s,o.debug),g("=== SESSION INITIALIZATION COMPLETED ===",o.debug)},command:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if("init"===t)return this.init.apply(this,r);if(!o.initialized||!e._trdt_uat_ready)return O(s,[t].concat(r)),!0;switch(t){case"config":return this.config.apply(this,r);case"set":return this.set.apply(this,r);case"event":return this.event.apply(this,r);case"consent":return this.consent.apply(this,r);case"get":return this.get.apply(this,r);default:return b("Unknown command:",t),!1}},config:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{};return e&&(o.attributionIds=Array.isArray(e)?e:[e]),Object.assign(o,t),g("Configuration updated:",o.debug,o),!0},set:function(e,t){var n=this;if("object"===C(e))return Object.entries(e).forEach((function(e){var t=j(e,2),r=t[0],i=t[1];n.set(r,i)})),!0;t=function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return e;if((t=e)&&("[object Function]"===Object.prototype.toString.call(t)||"function"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)))try{e=e()}catch(e){return o&&console.error("Attribution Core: Error evaluating function parameter",e),null}return function(e){return null!=e&&"string"==typeof e}(e)?(r=i,"string"==typeof(n=e)?n.substring(0,r):n):e}(t,100,o.debug);var r=v.canUseStorage(s.consentStatus);switch(e){case"user_id":s.userId=t,r&&(v.cookies.set("_trdt_uat_uid",t,365,r,o.cookieDomain,o.cookieSecure),v.local.set("_trdt_uat_uid",t,r,o.debug));break;case"client_id":s.clientId=t,r&&(v.cookies.set("_trdt_uat_cid",t,365,r,o.cookieDomain,o.cookieSecure),v.local.set("_trdt_uat_cid",t,r,o.debug));break;case"debug_mode":o.debug=!0===t||"true"===t;break;default:s.persistentParameters[e]=t}return g("Set ".concat(e,":"),o.debug,t),!0},event:function(r){var a=arguments.length>1&&arguments[1]!==i?arguments[1]:{};if(!e._trdt_uat_ready)return o.debug&&g("Event queued - not ready yet:",o.debug,r),O(s,["event",r,a]),!0;if(g("=== EVENT TRACKING STARTED ===",o.debug),f("EVENT - START",s,o.debug),!r)return b("Missing event name"),!1;o.debug&&(g("Event name:",o.debug,r),g("Event parameters:",o.debug,JSON.stringify(a))),s.sessionEngaged||(s.sessionEngaged=!0,o.debug&&g("Session marked as engaged",o.debug));var u=Object.assign({},a,{event_name:r}),c=_(u,o,s,v,t,n);o.debug&&(g("Event payload generated:",o.debug,JSON.stringify(c)),g("Client ID in payload:",o.debug,c.client_id),g("Session ID in payload:",o.debug,c.session_id),g("User ID in payload:",o.debug,c.user_id)),this.sendEvent(c);var d=v.canUseStorage(s.consentStatus);if(d)try{var m=l();if(v.cookies.set("_trdt_uat_last",m.toString(),0,d,o.cookieDomain,o.cookieSecure),o.debug){var p=v.cookies.get("_trdt_uat_last",d);g("Last activity updated in cookie to:",o.debug,p)}}catch(e){b("Error updating last activity during event:",e)}return s.hitCount++,f("EVENT - COMPLETE",s,o.debug),g("=== EVENT TRACKING COMPLETED ===",o.debug),!0},sendEvent:function(e){o.useServiceWorker&&h.canUseServiceWorker()&&s.consentStatus.analytics?p.sendViaServiceWorker(e,o):p.sendDirectRequest(e,o,this.saveOfflineEvent.bind(this))},saveOfflineEvent:function(e){var t=v.canUseStorage(s.consentStatus);k(e,t,o.offlineStorage,o.debug)},processOfflineEvents:function(){var e=v.canUseStorage(s.consentStatus);T(o.endpoint,e,o.offlineStorage,o.debug)},consent:function(e){if(!e||!e.hasOwnProperty("consent"))return b("Invalid consent parameters"),!1;var t=e.consent,n=Object.assign({},s.consentStatus),r=!1;return t.hasOwnProperty("analytics")&&n.analytics!==(!0===t.analytics)&&(s.consentStatus.analytics=!0===t.analytics,r=!0),t.hasOwnProperty("advertising")&&n.advertising!==(!0===t.advertising)&&(s.consentStatus.advertising=!0===t.advertising),t.hasOwnProperty("personalization")&&n.personalization!==(!0===t.personalization)&&(s.consentStatus.personalization=!0===t.personalization),(r||n.advertising!==s.consentStatus.advertising||n.personalization!==s.consentStatus.personalization)&&g("Consent updated:",o.debug,s.consentStatus),r&&(s.consentStatus.analytics?(g("Analytics consent granted",o.debug),o.useServiceWorker&&h.register(o,s,this.processOfflineEvents.bind(this))):(g("Analytics consent withdrawn",o.debug),v.clearAllTracking(!0))),!0},get:function(e){switch(e){case"client_id":return s.clientId;case"user_id":return s.userId;case"session_id":return s.sessionId;case"hit_count":return s.hitCount;case"consent_status":return Object.assign({},s.consentStatus);case"debug_mode":return o.debug;default:return s.persistentParameters[e]}}};e._trdt_uat=Object.assign((function(){var t=Array.from(arguments);return 0===t.length?e._trdt_uat:"string"==typeof t[0]?a.command.apply(a,t):(b("Invalid attrib function call"),!1)}),a),e.attrib=e.attrib||function(){if(o.initialized&&e._trdt_uat_ready)return e._trdt_uat.apply(null,arguments);var t=Array.from(arguments);return"init"===t[0]?e._trdt_uat.apply(null,t):(w(e,Array.from(arguments)),!0)},e._trdt_uat_queue.length>0&&(g("Found existing queue with",o.debug,e._trdt_uat_queue.length,"commands"),A(e,a.command.bind(a),o.debug)),void 0!==r&&void 0!==e&&(e.addEventListener("online",(function(){o.initialized&&v.canUseStorage(s.consentStatus)&&a.processOfflineEvents()})),r.addEventListener("visibilitychange",(function(){"visible"===r.visibilityState&&o.initialized&&v.canUseStorage(s.consentStatus)&&a.processOfflineEvents()})),e.addEventListener("beforeunload",(function(){"function"==typeof navigator.sendBeacon&&s.queue.length>0&&o.initialized&&s.queue.forEach((function(e){if("event"===e[0]){var r=e[1],i=e[2]||{},a=Object.assign({},i,{event_name:r}),u=_(a,o,s,v,t,n);p.sendBeacon(u,o)}}))})))}(window,document),e.default})()));