!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AttributionCore=t():e.AttributionCore=t()}(this,(()=>(()=>{"use strict";var e={};const t=function(){return{page_location:document.location.href,page_referrer:document.referrer,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)}},n=function(e){var t;return"node"===e||"undefined"==typeof window||"undefined"!=typeof window&&!("navigator"in window)?new Promise((function(e){e(null)})):null!==(t=navigator)&&void 0!==t&&null!==(t=t.userAgentData)&&void 0!==t&&t.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model","uaFullVersion","bitness","fullVersionList","wow64"]).then((function(e){var t,n,o;return{user_agent_architecture:e.architecture,user_agent_bitness:e.bitness,user_agent_full_version_list:encodeURIComponent((Object.values(e.fullVersionList)||(null===(t=navigator)||void 0===t||null===(t=t.userAgentData)||void 0===t?void 0:t.brands)).map((function(e){return[e.brand,e.version].join(";")})).join("|")),user_agent_mobile:e.mobile?1:0,user_agent_model:e.model||(null===(n=navigator)||void 0===n||null===(n=n.userAgentData)||void 0===n?void 0:n.mobile),user_agent_platform:e.platform||(null===(o=navigator)||void 0===o||null===(o=o.userAgentData)||void 0===o?void 0:o.platform),user_agent_platform_version:e.platformVersion,user_agent_wow64:e.wow64?1:0}})):new Promise((function(e){e(null)}))};var o=function(){return Math.floor(1*new Date/1e3)},i=function(){var e;return"undefined"!=typeof window&&void 0!==window.document?e="browser":"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node&&(e="node"),e};const r={canUseStorage:function(e){return!0===e.analytics},cookies:{get:function(e,t){if(!t||"undefined"==typeof document)return null;for(var n=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var r=o[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(n))return decodeURIComponent(r.substring(n.length,r.length))}return null},set:function(e,t,n,o){if(o&&"undefined"!=typeof document){var i="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+i+"; path=/; SameSite=Lax"}},remove:function(e,t){t&&"undefined"!=typeof document&&(document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax")}},local:{get:function(e,t,n){if(!t)return null;try{return localStorage.getItem(e)}catch(e){return n&&console.warn("[Attribution Core] localStorage access error",e),null}},set:function(e,t,n,o){if(n)try{localStorage.setItem(e,t)}catch(e){o&&console.warn("[Attribution Core] localStorage set error",e)}},remove:function(e,t,n){if(t)try{localStorage.removeItem(e)}catch(e){n&&console.warn("[Attribution Core] localStorage remove error",e)}}},clearAllTracking:function(e){e&&(this.cookies.remove("_trdt_uat_cid",!0),this.cookies.remove("_trdt_uat_sid",!0),this.cookies.remove("_trdt_uat_last",!0),this.local.remove("_trdt_uat_cid",!0,!1),this.local.remove("_trdt_uat_snum",!0,!1),this.local.remove("_trdt_uat_uid",!0,!1),this.local.remove("_trdt_uat_offline",!0,!1))}},s=function(e,t,n){t.attributionIds.forEach((function(o){var i=Object.assign({},e);if(i.attribution_id=o,"undefined"!=typeof fetch)fetch(t.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),keepalive:!0}).catch((function(e){console.error("[Attribution Core] Failed to send event:",e),n(i)}));else{var r=new XMLHttpRequest;r.open("POST",t.endpoint,!0),r.setRequestHeader("Content-Type","application/json"),r.timeout=1e4,r.onreadystatechange=function(){4===r.readyState&&(r.status<200||r.status>=300)&&(console.error("[Attribution Core] Failed to send event, status:",r.status),n(i))},r.onerror=function(){console.error("[Attribution Core] XHR error when sending event"),n(i)},r.send(JSON.stringify(i))}}))},a=function(e,t){var n="msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));navigator.serviceWorker.controller.postMessage({action:"recordEvent",endpoint:t.endpoint,payload:e,messageId:n,timestamp:Date.now()})},u=function(e,t){t.attributionIds.forEach((function(n){var o=Object.assign({},e);o.attribution_id=n,navigator.sendBeacon(t.endpoint,new Blob([JSON.stringify(o)],{type:"application/json"}))}))},c=function(e,t,n){if(!e.useServiceWorker||!t.consentStatus.analytics||void 0===navigator.serviceWorker)return!1;try{navigator.serviceWorker.register(e.swPath).then((function(t){e.debug&&console.log("[Attribution Core] Service Worker registered:",t),window.addEventListener("online",(function(){e.debug&&console.log("[Attribution Core] Online - processing offline events"),n()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&(e.debug&&console.log("[Attribution Core] Page visible - processing offline events"),n())}))})).catch((function(e){console.error("[Attribution Core] Service Worker registration failed:",e)}))}catch(e){return console.error("[Attribution Core] Error registering Service Worker:",e),!1}return!0},l=function(){return"undefined"!=typeof navigator&&void 0!==navigator.serviceWorker&&null!==navigator.serviceWorker.controller};function d(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}const f=function(e,t,n){if(n._trdt_uat_ready){var o=e.queue.slice();if(e.queue=[],o.length>0&&n._trdt_uat.get("debug_mode")&&console.log("[Attribution Core] Processing",o.length,"queued commands from local queue"),o.forEach((function(e){var n=e.shift();t.apply(void 0,[n].concat(d(e)))})),n._trdt_uat_queue&&Array.isArray(n._trdt_uat_queue)){var i=n._trdt_uat_queue.slice();n._trdt_uat_queue=[],i.length>0&&n._trdt_uat.get("debug_mode")&&console.log("[Attribution Core] Processing",i.length,"queued commands from global queue"),i.forEach((function(e){if(Array.isArray(e)){var n=e.shift();t.apply(void 0,[n].concat(d(e)))}}))}}},_=function(e,t,n){if(e._trdt_uat_queue&&e._trdt_uat_queue.length>0){n&&console.log("[Attribution Core] Found existing queue with",e._trdt_uat_queue.length,"commands");for(var o=0;o<e._trdt_uat_queue.length;o++){var i=e._trdt_uat_queue[o];if("init"===i[0])return e._trdt_uat_queue.splice(o,1),n&&console.log("[Attribution Core] Found and processing init command from queue"),t.apply(void 0,d(i)),!0}}return!1},v=function(e,t){return e.queue||(e.queue=[]),e.queue.push(t),!0},b=function(e,t){return e._trdt_uat_queue=e._trdt_uat_queue||[],e._trdt_uat_queue.push(t),!0},m=function(e,t,n,o){if(t&&n)try{var i=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");i.push({payload:e,timestamp:Date.now()}),localStorage.setItem("_trdt_uat_offline",JSON.stringify(i)),o&&console.log("[Attribution Core] Saved event for offline processing")}catch(e){console.error("[Attribution Core] Failed to save event for offline processing",e)}},p=function(e,t,n,o){if(t&&n)try{var i=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");if(0===i.length)return;o&&console.log("[Attribution Core] Processing ".concat(i.length," offline events"));var r=[];i.forEach((function(t){try{fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.payload),keepalive:!0}).catch((function(){r.push(t)}))}catch(e){r.push(t)}})),localStorage.setItem("_trdt_uat_offline",JSON.stringify(r)),o&&console.log("[Attribution Core] Processed offline events, ".concat(r.length," remaining"))}catch(e){console.error("[Attribution Core] Error processing offline events",e)}};function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,r,s,a=[],u=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=r.call(n)).done)&&(a.push(o.value),a.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return(t=function(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}return function(e,d,g){e._trdt_uat=e._trdt_uat||{},e._trdt_uat_queue=e._trdt_uat_queue||[],e._trdt_uat_ready=!1;var S={version:"1.1.3",debug:!1,endpoint:"https://t.trstdata.com/api/events",swPath:"https://cdn.jsdelivr.net/gh/trstdata/trustdata-js@main/dist/v1/core-sw-v1.js",useServiceWorker:"serviceWorker"in navigator,offlineStorage:!0,sessionTimeout:30,initialized:!1,attributionIds:null,instance:null,cookieDomain:"",cookieSecure:!0},I={clientId:null,userId:null,sessionId:null,sessionNumber:1,sessionEngaged:!1,hitCount:0,consentStatus:{analytics:!1,advertising:!1,personalization:!1},persistentParameters:{},queue:[]},A={generateId:function(){return Math.floor(2147483648*Math.random()+0)+"."+o()},getTimestamp:function(){return o()},sanitize:function(e){var t,n,o,i=arguments.length>1&&arguments[1]!==g?arguments[1]:100;if(null===e||e===g)return e;if((t=e)&&("[object Function]"===Object.prototype.toString.call(t)||"function"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)))try{e=e()}catch(e){return S.debug&&console.error("Attribution Core: Error evaluating function parameter",e),null}return function(e){return null!=e&&"string"==typeof e}(e)?(o=i,"string"==typeof(n=e)?n.substring(0,o):n):e},log:function(){if(S.debug){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];(e=console).log.apply(e,["[Attribution Core]"].concat(n))}},debugState:function(e){S.debug&&console.log("[Attribution Core DEBUG] ".concat(e," - Current STATE:"),{clientId:I.clientId,userId:I.userId,sessionId:I.sessionId,sessionNumber:I.sessionNumber,sessionEngaged:I.sessionEngaged,hitCount:I.hitCount,consentStatus:E({},I.consentStatus)})},error:function(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];(e=console).error.apply(e,["[Attribution Core]"].concat(n))},serializeEvent:function(e){S.debug&&(A.log("=== SERIALIZING EVENT ==="),A.debugState("SERIALIZE EVENT - START"));var o={};if(o.attribution_id=S.attributionIds,o.client_id=I.clientId,o.user_id=I.userId,o.session_id=I.sessionId,o.session_number=I.sessionNumber,o.session_engaged=I.sessionEngaged?1:0,o.hit_count=I.hitCount,o.event_time=A.getTimestamp(),S.debug&&(A.log("Basic payload data:"),A.log("- attribution_id:",o.attribution_id),A.log("- client_id:",o.client_id),A.log("- user_id:",o.user_id),A.log("- session_id:",o.session_id),A.log("- session_number:",o.session_number),A.log("- session_engaged:",o.session_engaged),A.log("- hit_count:",o.hit_count),A.log("- event_time:",o.event_time),r.canUseStorage(I.consentStatus))){var s=r.cookies.get("_trdt_uat_cid",!0),a=r.cookies.get("_trdt_uat_sid",!0),u=r.local.get("_trdt_uat_uid",!0,S.debug);A.log("Storage verification:"),A.log("- client_id in cookie:",s),A.log("- client_id in STATE:",I.clientId),A.log("- client_id match?",s===I.clientId.toString()),A.log("- session_id in cookie:",a),A.log("- session_id in STATE:",I.sessionId),A.log("- session_id match?",a===I.sessionId.toString()),A.log("- user_id in localStorage:",u),A.log("- user_id in STATE:",I.userId),A.log("- user_id match?",u===I.userId)}if(void 0!==d){var c=t();Object.entries(c).forEach((function(e){var t=h(e,2),n=t[0],i=t[1];o[n]=i})),S.debug&&A.log("Added page data:",c)}var l=i();if("browser"===l){n(l).then((function(e){e&&(Object.entries(e).forEach((function(e){var t=h(e,2),n=t[0],o=t[1];I.persistentParameters[n]=o})),S.debug&&A.log("Collected client hints for future events:",e))})).catch((function(e){S.debug&&console.warn("[Attribution Core] Error collecting client hints:",e)}));var g={};["user_agent_architecture","user_agent_bitness","user_agent_full_version_list","user_agent_mobile","user_agent_model","user_agent_platform","user_agent_platform_version","user_agent_wow64"].forEach((function(e){I.persistentParameters[e]&&(o[e]=I.persistentParameters[e],g[e]=I.persistentParameters[e])})),S.debug&&Object.keys(g).length>0&&A.log("Added existing client hints to payload:",g)}var f={};if(Object.entries(I.persistentParameters).forEach((function(e){var t=h(e,2),n=t[0],i=t[1];o[n]||(o[n]=i,f[n]=i)})),S.debug&&Object.keys(f).length>0&&A.log("Added persistent parameters to payload:",f),o.consent_analytics=I.consentStatus.analytics,o.consent_advertising=I.consentStatus.advertising,o.consent_personalization=I.consentStatus.personalization,S.debug&&(A.log("Added consent data:"),A.log("- analytics:",o.consent_analytics),A.log("- advertising:",o.consent_advertising),A.log("- personalization:",o.consent_personalization)),e){e.event_name&&(o.event_name=e.event_name,delete e.event_name,S.debug&&A.log("Added event name to payload:",o.event_name));var _={};Object.entries(e).forEach((function(e){var t=h(e,2),n=t[0],i=t[1];o[n]=i,_[n]=i})),S.debug&&Object.keys(_).length>0&&A.log("Added event-specific data to payload:",_)}return S.debug&&(A.log("=== EVENT SERIALIZATION COMPLETE ==="),A.log("Final payload:",o),A.debugState("SERIALIZE EVENT - COMPLETE")),o}},w={init:function(t){var o=this,s=arguments.length>1&&arguments[1]!==g?arguments[1]:{};if(!t)return A.error("Initialization failed: Missing attribution IDs"),!1;if(S.attributionIds=Array.isArray(t)?t:[t],Object.assign(S,s),S.debug&&A.log("Initializing with IDs:",S.attributionIds),S.initialized&&I.clientId)return S.debug&&A.log("Script already initialized, using existing state"),e._trdt_uat_ready&&e._trdt_uat_queue&&e._trdt_uat_queue.length>0&&setTimeout((function(){f(I,o.command.bind(o),e)}),0),!0;var a=r.canUseStorage(I.consentStatus),u=r.cookies.get("_trdt_uat_cid",a)||r.local.get("_trdt_uat_cid",a,S.debug)||s.client_id;if(u)I.clientId=u,S.debug&&A.log("Using existing client ID:",I.clientId);else if(I.clientId=A.generateId(),S.debug&&A.log("Generated new client ID:",I.clientId),a)try{r.cookies.set("_trdt_uat_cid",I.clientId,365,a,S.cookieDomain,S.cookieSecure),r.local.set("_trdt_uat_cid",I.clientId,a,S.debug)}catch(e){A.error("Error storing client ID:",e)}var l=r.local.get("_trdt_uat_uid",a,S.debug)||s.user_id;S.debug&&A.log("Existing user ID from storage:",l),l&&(I.userId=l,S.debug&&A.log("Loaded existing user ID:",I.userId)),A.debugState("INIT - BEFORE SESSION INIT"),this.initSession(),A.debugState("INIT - AFTER SESSION INIT"),S.initialized=!0;var d=i();return"browser"===d&&n(d).then((function(e){e&&(Object.entries(e).forEach((function(e){var t=h(e,2),n=t[0],o=t[1];I.persistentParameters[n]=o})),S.debug&&A.log("Collected client hints:",e))})).catch((function(e){S.debug&&console.warn("[Attribution Core] Error collecting client hints:",e)})),S.useServiceWorker&&I.consentStatus.analytics&&c(S,I,this.processOfflineEvents.bind(this)),setTimeout((function(){if(S.debug){var t=r.cookies.get("_trdt_uat_cid",a),n=r.cookies.get("_trdt_uat_sid",a);A.log("Storage verification after initialization:"),A.log("- client_id in cookie:",t),A.log("- client_id in STATE:",I.clientId),A.log("- client_id match?",t===I.clientId.toString()),A.log("- session_id in cookie:",n),A.log("- session_id in STATE:",I.sessionId),A.log("- session_id match?",n===I.sessionId.toString())}e._trdt_uat_ready=!0,f(I,o.command.bind(o),e),A.debugState("INIT - COMPLETE"),A.log("=== INITIALIZATION COMPLETED ===")}),100),!0},initSession:function(){A.log("=== SESSION INITIALIZATION STARTED ===");var e=A.getTimestamp(),t=r.canUseStorage(I.consentStatus);if(S.debug&&(A.log("Current timestamp:",e),A.log("Can use storage:",t)),t){var n=r.cookies.get("_trdt_uat_sid",t),o=r.local.get("_trdt_uat_snum",t,S.debug),i=r.cookies.get("_trdt_uat_last",t);S.debug&&(A.log("Stored session ID from cookie:",n),A.log("Stored session number from localStorage:",o),A.log("Last activity timestamp from cookie:",i)),I.sessionNumber=parseInt(o||"1");var s=parseInt(i||"0"),a=e-s>60*S.sessionTimeout;if(S.debug&&(A.log("Parsed session number:",I.sessionNumber),A.log("Parsed last activity:",s),A.log("Session timeout (in seconds):",60*S.sessionTimeout),A.log("Time since last activity (in seconds):",e-s),A.log("Session timed out?",a)),!n||a){I.sessionId=e,I.sessionNumber++,I.sessionEngaged=!1,S.debug&&(A.log("Creating new session with timestamp:",I.sessionId),A.log("New session number:",I.sessionNumber),n?A.log("Reason: Session timeout"):A.log("Reason: No previous session ID found"));try{if(r.local.set("_trdt_uat_snum",I.sessionNumber.toString(),t,S.debug),r.cookies.set("_trdt_uat_sid",I.sessionId.toString(),0,t,S.cookieDomain,S.cookieSecure),r.cookies.set("_trdt_uat_last",e.toString(),0,t,S.cookieDomain,S.cookieSecure),S.debug){var u=r.cookies.get("_trdt_uat_sid",t),c=r.local.get("_trdt_uat_snum",t,S.debug),l=r.cookies.get("_trdt_uat_last",t);A.log("Verification - Session ID stored in cookie:",u),A.log("Verification - Session number stored in localStorage:",c),A.log("Verification - Last activity stored in cookie:",l)}}catch(e){A.error("Error storing session data:",e)}}else{I.sessionId=parseInt(n),I.sessionEngaged=!0,S.debug&&A.log("Continuing existing session with ID:",I.sessionId);try{if(r.cookies.set("_trdt_uat_last",e.toString(),0,t,S.cookieDomain,S.cookieSecure),S.debug){var d=r.cookies.get("_trdt_uat_last",t);A.log("Verification - Updated last activity in cookie:",d)}}catch(e){A.error("Error updating last activity:",e)}}}else I.sessionId=e,I.sessionNumber=1,I.sessionEngaged=!1,S.debug&&A.log("Created ephemeral session (no storage consent) with ID:",I.sessionId);A.debugState("SESSION INIT - COMPLETE"),A.log("=== SESSION INITIALIZATION COMPLETED ===")},command:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];if("init"===t)return this.init.apply(this,o);if(!S.initialized||!e._trdt_uat_ready)return v(I,[t].concat(o)),!0;switch(t){case"config":return this.config.apply(this,o);case"set":return this.set.apply(this,o);case"event":return this.event.apply(this,o);case"consent":return this.consent.apply(this,o);case"get":return this.get.apply(this,o);default:return A.error("Unknown command:",t),!1}},config:function(e){var t=arguments.length>1&&arguments[1]!==g?arguments[1]:{};return e&&(S.attributionIds=Array.isArray(e)?e:[e]),Object.assign(S,t),A.log("Configuration updated:",S),!0},set:function(e,t){var n=this;if("object"===y(e))return Object.entries(e).forEach((function(e){var t=h(e,2),o=t[0],i=t[1];n.set(o,i)})),!0;t=A.sanitize(t);var o=r.canUseStorage(I.consentStatus);switch(e){case"user_id":I.userId=t,o&&(r.cookies.set("_trdt_uat_uid",t,365,o,S.cookieDomain,S.cookieSecure),r.local.set("_trdt_uat_uid",t,o,S.debug));break;case"client_id":I.clientId=t,o&&(r.cookies.set("_trdt_uat_cid",t,365,o,S.cookieDomain,S.cookieSecure),r.local.set("_trdt_uat_cid",t,o,S.debug));break;case"debug_mode":S.debug=!0===t||"true"===t;break;default:I.persistentParameters[e]=t}return A.log("Set ".concat(e,":"),t),!0},event:function(t){var n=arguments.length>1&&arguments[1]!==g?arguments[1]:{};if(!e._trdt_uat_ready)return S.debug&&A.log("Event queued - not ready yet:",t),v(I,["event",t,n]),!0;if(A.log("=== EVENT TRACKING STARTED ==="),A.debugState("EVENT - START"),!t)return A.error("Missing event name"),!1;S.debug&&(A.log("Event name:",t),A.log("Event parameters:",JSON.stringify(n))),I.sessionEngaged||(I.sessionEngaged=!0,S.debug&&A.log("Session marked as engaged"));var o=Object.assign({},n,{event_name:t}),i=A.serializeEvent(o);S.debug&&(A.log("Event payload generated:",JSON.stringify(i)),A.log("Client ID in payload:",i.client_id),A.log("Session ID in payload:",i.session_id),A.log("User ID in payload:",i.user_id)),this.sendEvent(i);var s=r.canUseStorage(I.consentStatus);if(s)try{var a=A.getTimestamp();if(r.cookies.set("_trdt_uat_last",a.toString(),0,s,S.cookieDomain,S.cookieSecure),S.debug){var u=r.cookies.get("_trdt_uat_last",s);A.log("Last activity updated in cookie to:",u)}}catch(e){A.error("Error updating last activity during event:",e)}return I.hitCount++,A.debugState("EVENT - COMPLETE"),A.log("=== EVENT TRACKING COMPLETED ==="),!0},sendEvent:function(e){S.useServiceWorker&&l()&&I.consentStatus.analytics?a(e,S):s(e,S,this.saveOfflineEvent.bind(this))},saveOfflineEvent:function(e){var t=r.canUseStorage(I.consentStatus);m(e,t,S.offlineStorage,S.debug)},processOfflineEvents:function(){var e=r.canUseStorage(I.consentStatus);p(S.endpoint,e,S.offlineStorage,S.debug)},consent:function(e){if(!e||!e.hasOwnProperty("consent"))return A.error("Invalid consent parameters"),!1;var t=e.consent,n=Object.assign({},I.consentStatus),o=!1;return t.hasOwnProperty("analytics")&&n.analytics!==(!0===t.analytics)&&(I.consentStatus.analytics=!0===t.analytics,o=!0),t.hasOwnProperty("advertising")&&n.advertising!==(!0===t.advertising)&&(I.consentStatus.advertising=!0===t.advertising),t.hasOwnProperty("personalization")&&n.personalization!==(!0===t.personalization)&&(I.consentStatus.personalization=!0===t.personalization),(o||n.advertising!==I.consentStatus.advertising||n.personalization!==I.consentStatus.personalization)&&A.log("Consent updated:",I.consentStatus),o&&(I.consentStatus.analytics?(A.log("Analytics consent granted"),S.useServiceWorker&&c(S,I,this.processOfflineEvents.bind(this))):(A.log("Analytics consent withdrawn"),r.clearAllTracking(!0))),!0},get:function(e){switch(e){case"client_id":return I.clientId;case"user_id":return I.userId;case"session_id":return I.sessionId;case"hit_count":return I.hitCount;case"consent_status":return Object.assign({},I.consentStatus);case"debug_mode":return S.debug;default:return I.persistentParameters[e]}}};e._trdt_uat=Object.assign((function(){var t=Array.from(arguments);return 0===t.length?e._trdt_uat:"string"==typeof t[0]?w.command.apply(w,t):(A.error("Invalid attrib function call"),!1)}),w),e.attrib=e.attrib||function(){var t=Array.from(arguments);return"init"===t[0]||S.initialized&&e._trdt_uat_ready?e._trdt_uat.apply(null,t):(b(e,t),!0)},e._trdt_uat_queue.length>0&&(A.log("Found existing queue with",e._trdt_uat_queue.length,"commands"),_(e,w.command.bind(w),S.debug).catch((function(e){A.error("Error processing init command from queue:",e)}))),void 0!==d&&void 0!==e&&(e.addEventListener("online",(function(){S.initialized&&r.canUseStorage(I.consentStatus)&&w.processOfflineEvents()})),d.addEventListener("visibilitychange",(function(){"visible"===d.visibilityState&&S.initialized&&r.canUseStorage(I.consentStatus)&&w.processOfflineEvents()})),e.addEventListener("beforeunload",(function(){"function"==typeof navigator.sendBeacon&&I.queue.length>0&&S.initialized&&I.queue.forEach((function(e){if("event"===e[0]){var t=e[1],n=e[2]||{},o=Object.assign({},n,{event_name:t}),i=A.serializeEvent(o);u(i,S)}}))})))}(window,document),e.default})()));