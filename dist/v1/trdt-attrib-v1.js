/*! For license information please see trdt-attrib.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AttributionCore=e():t.AttributionCore=e()}(this,(()=>(()=>{"use strict";var t={};const e=function(){return{page_location:document.location.href,page_referrer:document.referrer,page_title:document.title,language:(navigator&&(navigator.language||navigator.browserLanguage)||"").toLowerCase(),screen_resolution:(window.screen?window.screen.width:0)+"x"+(window.screen?window.screen.height:0)}},n=function(t){var e;return"node"===t||"undefined"==typeof window||"undefined"!=typeof window&&!("navigator"in window)?new Promise((function(t){t(null)})):null!==(e=navigator)&&void 0!==e&&null!==(e=e.userAgentData)&&void 0!==e&&e.getHighEntropyValues?navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model","uaFullVersion","bitness","fullVersionList","wow64"]).then((function(t){var e,n,r;return{user_agent_architecture:t.architecture,user_agent_bitness:t.bitness,user_agent_full_version_list:encodeURIComponent((Object.values(t.fullVersionList)||(null===(e=navigator)||void 0===e||null===(e=e.userAgentData)||void 0===e?void 0:e.brands)).map((function(t){return[t.brand,t.version].join(";")})).join("|")),user_agent_mobile:t.mobile?1:0,user_agent_model:t.model||(null===(n=navigator)||void 0===n||null===(n=n.userAgentData)||void 0===n?void 0:n.mobile),user_agent_platform:t.platform||(null===(r=navigator)||void 0===r||null===(r=r.userAgentData)||void 0===r?void 0:r.platform),user_agent_platform_version:t.platformVersion,user_agent_wow64:t.wow64?1:0}})):new Promise((function(t){t(null)}))};var r=function(){return Math.floor(1*new Date/1e3)},o=function(){var t;return"undefined"!=typeof window&&void 0!==window.document?t="browser":"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node&&(t="node"),t};const i={canUseStorage:function(t){return!0===t.analytics},cookies:{get:function(t,e){if(!e||"undefined"==typeof document)return null;for(var n=t+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return decodeURIComponent(i.substring(n.length,i.length))}return null},set:function(t,e,n,r){if(r&&"undefined"!=typeof document){var o="";if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),o="; expires="+i.toUTCString()}document.cookie=t+"="+encodeURIComponent(e)+o+"; path=/; SameSite=Lax"}},remove:function(t,e){e&&"undefined"!=typeof document&&(document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax")}},local:{get:function(t,e,n){if(!e)return null;try{return localStorage.getItem(t)}catch(t){return n&&console.warn("[Attribution Core] localStorage access error",t),null}},set:function(t,e,n,r){if(n)try{localStorage.setItem(t,e)}catch(t){r&&console.warn("[Attribution Core] localStorage set error",t)}},remove:function(t,e,n){if(e)try{localStorage.removeItem(t)}catch(t){n&&console.warn("[Attribution Core] localStorage remove error",t)}}},clearAllTracking:function(t){t&&(this.cookies.remove("_trdt_uat_cid",!0),this.cookies.remove("_trdt_uat_sid",!0),this.cookies.remove("_trdt_uat_last",!0),this.local.remove("_trdt_uat_cid",!0,!1),this.local.remove("_trdt_uat_snum",!0,!1),this.local.remove("_trdt_uat_uid",!0,!1),this.local.remove("_trdt_uat_offline",!0,!1))}},a=function(t,e,n){e.attributionIds.forEach((function(r){var o=Object.assign({},t);if(o.attribution_id=r,"undefined"!=typeof fetch)fetch(e.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),keepalive:!0}).catch((function(t){console.error("[Attribution Core] Failed to send event:",t),n(o)}));else{var i=new XMLHttpRequest;i.open("POST",e.endpoint,!0),i.setRequestHeader("Content-Type","application/json"),i.timeout=1e4,i.onreadystatechange=function(){4===i.readyState&&(i.status<200||i.status>=300)&&(console.error("[Attribution Core] Failed to send event, status:",i.status),n(o))},i.onerror=function(){console.error("[Attribution Core] XHR error when sending event"),n(o)},i.send(JSON.stringify(o))}}))},s=function(t,e){var n="msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));navigator.serviceWorker.controller.postMessage({action:"recordEvent",endpoint:e.endpoint,payload:t,messageId:n,timestamp:Date.now()})},u=function(t,e){e.attributionIds.forEach((function(n){var r=Object.assign({},t);r.attribution_id=n,navigator.sendBeacon(e.endpoint,new Blob([JSON.stringify(r)],{type:"application/json"}))}))},c=function(t,e,n){if(!t.useServiceWorker||!e.consentStatus.analytics||void 0===navigator.serviceWorker)return!1;try{navigator.serviceWorker.register(t.swPath).then((function(e){t.debug&&console.log("[Attribution Core] Service Worker registered:",e),window.addEventListener("online",(function(){t.debug&&console.log("[Attribution Core] Online - processing offline events"),n()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&(t.debug&&console.log("[Attribution Core] Page visible - processing offline events"),n())}))})).catch((function(t){console.error("[Attribution Core] Service Worker registration failed:",t)}))}catch(t){return console.error("[Attribution Core] Error registering Service Worker:",t),!1}return!0},l=function(){return"undefined"!=typeof navigator&&void 0!==navigator.serviceWorker&&null!==navigator.serviceWorker.controller};function d(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}const f=function(t,e,n){var r=t.queue.slice();t.queue=[];var o=Promise.resolve();if(r.forEach((function(t){var n=t.shift();o=o.then((function(){return e.apply(void 0,[n].concat(d(t)))}))})),n._trdt_uat_queue&&Array.isArray(n._trdt_uat_queue)){var i=n._trdt_uat_queue.slice();n._trdt_uat_queue=[],i.forEach((function(t){if(Array.isArray(t)){var n=t.shift();o=o.then((function(){return e.apply(void 0,[n].concat(d(t)))}))}}))}return o},v=function(t,e,n){if(t._trdt_uat_queue&&t._trdt_uat_queue.length>0){n&&console.log("[Attribution Core] Found existing queue with",t._trdt_uat_queue.length,"commands");for(var r=0;r<t._trdt_uat_queue.length;r++){var o=t._trdt_uat_queue[r];if("init"===o[0])return t._trdt_uat_queue.splice(r,1),n&&console.log("[Attribution Core] Found and processing init command from queue"),e.apply(void 0,d(o)).then((function(){return Promise.resolve(!0)}))}}return Promise.resolve(!1)},h=function(t,e){return t.queue||(t.queue=[]),t.queue.push(e),!0},p=function(t,e){return t._trdt_uat_queue=t._trdt_uat_queue||[],t._trdt_uat_queue.push(e),!0},_=function(t,e,n,r){if(e&&n)try{var o=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");o.push({payload:t,timestamp:Date.now()}),localStorage.setItem("_trdt_uat_offline",JSON.stringify(o)),r&&console.log("[Attribution Core] Saved event for offline processing")}catch(t){console.error("[Attribution Core] Failed to save event for offline processing",t)}},m=function(t,e,n,r){if(e&&n)try{var o=JSON.parse(localStorage.getItem("_trdt_uat_offline")||"[]");if(0===o.length)return;r&&console.log("[Attribution Core] Processing ".concat(o.length," offline events"));var i=[];o.forEach((function(e){try{fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.payload),keepalive:!0}).catch((function(){i.push(e)}))}catch(t){i.push(e)}})),localStorage.setItem("_trdt_uat_offline",JSON.stringify(i)),r&&console.log("[Attribution Core] Processed offline events, ".concat(i.length," remaining"))}catch(t){console.error("[Attribution Core] Error processing offline events",t)}};function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function b(){b=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof _?e:_,a=Object.create(i.prototype),s=new L(r||[]);return o(a,"_invoke",{value:T(t,n,s)}),a}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var g="suspendedStart",f="suspendedYield",v="executing",h="completed",p={};function _(){}function m(){}function S(){}var E={};c(E,a,(function(){return this}));var I=Object.getPrototypeOf,w=I&&I(I(N([])));w&&w!==n&&r.call(w,a)&&(E=w);var O=S.prototype=_.prototype=Object.create(E);function A(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(o,i,a,s){var u=d(t[o],t,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==y(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,n,r){var o=g;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===h){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=j(s,r);if(u){if(u===p)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===g)throw o=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=d(e,n,r);if("normal"===c.type){if(o=r.done?h:f,c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=h,r.method="throw",r.arg=c.arg)}}}function j(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,j(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var i=d(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function N(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(y(e)+" is not iterable")}return m.prototype=S,o(O,"constructor",{value:S,configurable:!0}),o(S,"constructor",{value:m,configurable:!0}),m.displayName=c(S,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,S):(t.__proto__=S,c(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},A(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new k(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(O),c(O,u,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=N,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:N(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),p}},e}function S(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],u=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return I(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){A(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function A(t,e,n){return(e=function(t){var e=function(t){if("object"!=y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}return function(t,d,g){t._trdt_uat=t._trdt_uat||{},t._trdt_uat_queue=t._trdt_uat_queue||[];var I,w,A={version:"1.1.3",debug:!1,endpoint:"https://t.trstdata.com/api/events",swPath:"https://cdn.jsdelivr.net/gh/trstdata/trustdata-js@main/dist/v1/core-sw-v1.js",useServiceWorker:"serviceWorker"in navigator,offlineStorage:!0,sessionTimeout:30,initialized:!1,attributionIds:null,instance:null,cookieDomain:"",cookieSecure:!0},k={clientId:null,userId:null,sessionId:null,sessionNumber:1,sessionEngaged:!1,hitCount:0,consentStatus:{analytics:!1,advertising:!1,personalization:!1},persistentParameters:{},queue:[]},T={generateId:function(){return Math.floor(2147483648*Math.random()+0)+"."+r()},getTimestamp:function(){return r()},sanitize:function(t){var e,n,r,o=arguments.length>1&&arguments[1]!==g?arguments[1]:100;if(null===t||t===g)return t;if((e=t)&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)))try{t=t()}catch(t){return A.debug&&console.error("Attribution Core: Error evaluating function parameter",t),null}return function(t){return null!=t&&"string"==typeof t}(t)?(r=o,"string"==typeof(n=t)?n.substring(0,r):n):t},log:function(){if(A.debug){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).log.apply(t,["[Attribution Core]"].concat(n))}},debugState:function(t){A.debug&&console.log("[Attribution Core DEBUG] ".concat(t," - Current STATE:"),{clientId:k.clientId,userId:k.userId,sessionId:k.sessionId,sessionNumber:k.sessionNumber,sessionEngaged:k.sessionEngaged,hitCount:k.hitCount,consentStatus:O({},k.consentStatus)})},error:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).error.apply(t,["[Attribution Core]"].concat(n))},serializeEvent:function(t){A.debug&&(T.log("=== SERIALIZING EVENT ==="),T.debugState("SERIALIZE EVENT - START"));var r={};if(r.attribution_id=A.attributionIds,r.client_id=k.clientId,r.user_id=k.userId,r.session_id=k.sessionId,r.session_number=k.sessionNumber,r.session_engaged=k.sessionEngaged?1:0,r.hit_count=k.hitCount,r.event_time=T.getTimestamp(),A.debug&&(T.log("Basic payload data:"),T.log("- attribution_id:",r.attribution_id),T.log("- client_id:",r.client_id),T.log("- user_id:",r.user_id),T.log("- session_id:",r.session_id),T.log("- session_number:",r.session_number),T.log("- session_engaged:",r.session_engaged),T.log("- hit_count:",r.hit_count),T.log("- event_time:",r.event_time),i.canUseStorage(k.consentStatus))){var a=i.cookies.get("_trdt_uat_cid",!0),s=i.cookies.get("_trdt_uat_sid",!0),u=i.local.get("_trdt_uat_uid",!0,A.debug);T.log("Storage verification:"),T.log("- client_id in cookie:",a),T.log("- client_id in STATE:",k.clientId),T.log("- client_id match?",a===k.clientId.toString()),T.log("- session_id in cookie:",s),T.log("- session_id in STATE:",k.sessionId),T.log("- session_id match?",s===k.sessionId.toString()),T.log("- user_id in localStorage:",u),T.log("- user_id in STATE:",k.userId),T.log("- user_id match?",u===k.userId)}if(void 0!==d){var c=e();Object.entries(c).forEach((function(t){var e=E(t,2),n=e[0],o=e[1];r[n]=o})),A.debug&&T.log("Added page data:",c)}var l=o();if("browser"===l){n(l).then((function(t){t&&(Object.entries(t).forEach((function(t){var e=E(t,2),n=e[0],r=e[1];k.persistentParameters[n]=r})),A.debug&&T.log("Collected client hints for future events:",t))})).catch((function(t){A.debug&&console.warn("[Attribution Core] Error collecting client hints:",t)}));var g={};["user_agent_architecture","user_agent_bitness","user_agent_full_version_list","user_agent_mobile","user_agent_model","user_agent_platform","user_agent_platform_version","user_agent_wow64"].forEach((function(t){k.persistentParameters[t]&&(r[t]=k.persistentParameters[t],g[t]=k.persistentParameters[t])})),A.debug&&Object.keys(g).length>0&&T.log("Added existing client hints to payload:",g)}var f={};if(Object.entries(k.persistentParameters).forEach((function(t){var e=E(t,2),n=e[0],o=e[1];r[n]||(r[n]=o,f[n]=o)})),A.debug&&Object.keys(f).length>0&&T.log("Added persistent parameters to payload:",f),r.consent_analytics=k.consentStatus.analytics,r.consent_advertising=k.consentStatus.advertising,r.consent_personalization=k.consentStatus.personalization,A.debug&&(T.log("Added consent data:"),T.log("- analytics:",r.consent_analytics),T.log("- advertising:",r.consent_advertising),T.log("- personalization:",r.consent_personalization)),t){t.event_name&&(r.event_name=t.event_name,delete t.event_name,A.debug&&T.log("Added event name to payload:",r.event_name));var v={};Object.entries(t).forEach((function(t){var e=E(t,2),n=e[0],o=e[1];r[n]=o,v[n]=o})),A.debug&&Object.keys(v).length>0&&T.log("Added event-specific data to payload:",v)}return A.debug&&(T.log("=== EVENT SERIALIZATION COMPLETE ==="),T.log("Final payload:",r),T.debugState("SERIALIZE EVENT - COMPLETE")),r}},j={init:(I=b().mark((function e(r){var a,s,u,l,d,v,h=arguments;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>1&&h[1]!==g?h[1]:{},r){e.next=4;break}return T.error("Initialization failed: Missing attribution IDs"),e.abrupt("return",Promise.reject("Missing attribution IDs"));case 4:if(A.attributionIds=Array.isArray(r)?r:[r],Object.assign(A,a),A.debug&&T.log("Initializing with IDs:",A.attributionIds),!A.initialized||!k.clientId){e.next=10;break}return A.debug&&T.log("Script already initialized, using existing state"),e.abrupt("return",Promise.resolve(!0));case 10:if(s=i.canUseStorage(k.consentStatus),u=a.client_id||i.cookies.get("_trdt_uat_cid",s)||i.local.get("_trdt_uat_cid",s,A.debug))k.clientId=u,A.debug&&T.log("Using existing client ID:",k.clientId);else if(k.clientId=T.generateId(),A.debug&&T.log("Generated new client ID:",k.clientId),s)try{i.cookies.set("_trdt_uat_cid",k.clientId,365,s,A.cookieDomain,A.cookieSecure),i.local.set("_trdt_uat_cid",k.clientId,s,A.debug)}catch(t){T.error("Error storing client ID:",t)}return l=a.user_id||i.local.get("_trdt_uat_uid",s,A.debug),A.debug&&T.log("Existing user ID from storage:",l),l&&(k.userId=l,A.debug&&T.log("Loaded existing user ID:",k.userId)),T.debugState("INIT - BEFORE SESSION INIT"),this.initSession(),T.debugState("INIT - AFTER SESSION INIT"),d=function(){return new Promise((function(t){setTimeout((function(){if(A.debug){var e=i.cookies.get("_trdt_uat_cid",s),n=i.cookies.get("_trdt_uat_sid",s);T.log("Storage verification after delay:"),T.log("- client_id in cookie:",e),T.log("- client_id in STATE:",k.clientId),T.log("- client_id match?",e===k.clientId.toString()),T.log("- session_id in cookie:",n),T.log("- session_id in STATE:",k.sessionId),T.log("- session_id match?",n===k.sessionId.toString())}t()}),50)}))},"browser"===(v=o())&&n(v).then((function(t){t&&(Object.entries(t).forEach((function(t){var e=E(t,2),n=e[0],r=e[1];k.persistentParameters[n]=r})),A.debug&&T.log("Collected client hints:",t))})).catch((function(t){A.debug&&console.warn("[Attribution Core] Error collecting client hints:",t)})),e.next=24,d();case 24:return A.initialized=!0,f(k,this.command.bind(this),t),A.useServiceWorker&&k.consentStatus.analytics&&c(A,k,this.processOfflineEvents.bind(this)),T.debugState("INIT - COMPLETE"),T.log("=== INITIALIZATION COMPLETED ==="),e.abrupt("return",!0);case 30:case"end":return e.stop()}}),e,this)})),w=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=I.apply(t,e);function i(t){S(o,n,r,i,a,"next",t)}function a(t){S(o,n,r,i,a,"throw",t)}i(void 0)}))},function(t){return w.apply(this,arguments)}),initSession:function(){T.log("=== SESSION INITIALIZATION STARTED ===");var t=T.getTimestamp(),e=i.canUseStorage(k.consentStatus);if(A.debug&&(T.log("Current timestamp:",t),T.log("Can use storage:",e)),e){var n=i.cookies.get("_trdt_uat_sid",e),r=i.local.get("_trdt_uat_snum",e,A.debug),o=i.cookies.get("_trdt_uat_last",e);A.debug&&(T.log("Stored session ID from cookie:",n),T.log("Stored session number from localStorage:",r),T.log("Last activity timestamp from cookie:",o)),k.sessionNumber=parseInt(r||"1");var a=parseInt(o||"0"),s=t-a>60*A.sessionTimeout;if(A.debug&&(T.log("Parsed session number:",k.sessionNumber),T.log("Parsed last activity:",a),T.log("Session timeout (in seconds):",60*A.sessionTimeout),T.log("Time since last activity (in seconds):",t-a),T.log("Session timed out?",s)),!n||s){k.sessionId=t,k.sessionNumber++,k.sessionEngaged=!1,A.debug&&(T.log("Creating new session with timestamp:",k.sessionId),T.log("New session number:",k.sessionNumber),n?T.log("Reason: Session timeout"):T.log("Reason: No previous session ID found"));try{if(i.local.set("_trdt_uat_snum",k.sessionNumber.toString(),e,A.debug),i.cookies.set("_trdt_uat_sid",k.sessionId.toString(),0,e,A.cookieDomain,A.cookieSecure),i.cookies.set("_trdt_uat_last",t.toString(),0,e,A.cookieDomain,A.cookieSecure),A.debug){var u=i.cookies.get("_trdt_uat_sid",e),c=i.local.get("_trdt_uat_snum",e,A.debug),l=i.cookies.get("_trdt_uat_last",e);T.log("Verification - Session ID stored in cookie:",u),T.log("Verification - Session number stored in localStorage:",c),T.log("Verification - Last activity stored in cookie:",l)}}catch(t){T.error("Error storing session data:",t)}}else{k.sessionId=parseInt(n),k.sessionEngaged=!0,A.debug&&T.log("Continuing existing session with ID:",k.sessionId);try{if(i.cookies.set("_trdt_uat_last",t.toString(),0,e,A.cookieDomain,A.cookieSecure),A.debug){var d=i.cookies.get("_trdt_uat_last",e);T.log("Verification - Updated last activity in cookie:",d)}}catch(t){T.error("Error updating last activity:",t)}}}else k.sessionId=t,k.sessionNumber=1,k.sessionEngaged=!1,A.debug&&T.log("Created ephemeral session (no storage consent) with ID:",k.sessionId);T.debugState("SESSION INIT - COMPLETE"),T.log("=== SESSION INITIALIZATION COMPLETED ===")},command:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(!A.initialized&&"init"!==t)return h(k,[t].concat(n)),Promise.resolve("Command queued");switch(t){case"init":return this.init.apply(this,n);case"config":return Promise.resolve(this.config.apply(this,n));case"set":return Promise.resolve(this.set.apply(this,n));case"event":return Promise.resolve(this.event.apply(this,n));case"consent":return Promise.resolve(this.consent.apply(this,n));case"get":return Promise.resolve(this.get.apply(this,n));default:return T.error("Unknown command:",t),Promise.reject("Unknown command")}},config:function(t){var e=arguments.length>1&&arguments[1]!==g?arguments[1]:{};return t&&(A.attributionIds=Array.isArray(t)?t:[t]),Object.assign(A,e),T.log("Configuration updated:",A),!0},set:function(t,e){var n=this;if("object"===y(t))return Object.entries(t).forEach((function(t){var e=E(t,2),r=e[0],o=e[1];n.set(r,o)})),!0;e=T.sanitize(e);var r=i.canUseStorage(k.consentStatus);switch(t){case"user_id":k.userId=e,r&&(i.cookies.set("_trdt_uat_uid",e,365,r,A.cookieDomain,A.cookieSecure),i.local.set("_trdt_uat_uid",e,r,A.debug));break;case"client_id":k.clientId=e,r&&(i.cookies.set("_trdt_uat_cid",e,365,r,A.cookieDomain,A.cookieSecure),i.local.set("_trdt_uat_cid",e,r,A.debug));break;case"debug_mode":A.debug=!0===e||"true"===e;break;default:k.persistentParameters[t]=e}return T.log("Set ".concat(t,":"),e),!0},event:function(t){var e=arguments.length>1&&arguments[1]!==g?arguments[1]:{};if(T.log("=== EVENT TRACKING STARTED ==="),T.debugState("EVENT - START"),!t)return T.error("Missing event name"),!1;A.debug&&(T.log("Event name:",t),T.log("Event parameters:",JSON.stringify(e))),k.sessionEngaged||(k.sessionEngaged=!0,A.debug&&T.log("Session marked as engaged"));var n=Object.assign({},e,{event_name:t}),r=T.serializeEvent(n);A.debug&&(T.log("Event payload generated:",JSON.stringify(r)),T.log("Client ID in payload:",r.client_id),T.log("Session ID in payload:",r.session_id),T.log("User ID in payload:",r.user_id)),this.sendEvent(r);var o=i.canUseStorage(k.consentStatus);if(o)try{var a=T.getTimestamp();if(i.cookies.set("_trdt_uat_last",a.toString(),0,o,A.cookieDomain,A.cookieSecure),A.debug){var s=i.cookies.get("_trdt_uat_last",o);T.log("Last activity updated in cookie to:",s)}}catch(t){T.error("Error updating last activity during event:",t)}return k.hitCount++,T.debugState("EVENT - COMPLETE"),T.log("=== EVENT TRACKING COMPLETED ==="),!0},sendEvent:function(t){A.useServiceWorker&&l()&&k.consentStatus.analytics?s(t,A):a(t,A,this.saveOfflineEvent.bind(this))},saveOfflineEvent:function(t){var e=i.canUseStorage(k.consentStatus);_(t,e,A.offlineStorage,A.debug)},processOfflineEvents:function(){var t=i.canUseStorage(k.consentStatus);m(A.endpoint,t,A.offlineStorage,A.debug)},consent:function(t){if(!t||!t.hasOwnProperty("consent"))return T.error("Invalid consent parameters"),!1;var e=t.consent,n=Object.assign({},k.consentStatus),r=!1;return e.hasOwnProperty("analytics")&&n.analytics!==(!0===e.analytics)&&(k.consentStatus.analytics=!0===e.analytics,r=!0),e.hasOwnProperty("advertising")&&n.advertising!==(!0===e.advertising)&&(k.consentStatus.advertising=!0===e.advertising),e.hasOwnProperty("personalization")&&n.personalization!==(!0===e.personalization)&&(k.consentStatus.personalization=!0===e.personalization),(r||n.advertising!==k.consentStatus.advertising||n.personalization!==k.consentStatus.personalization)&&T.log("Consent updated:",k.consentStatus),r&&(k.consentStatus.analytics?(T.log("Analytics consent granted"),A.useServiceWorker&&c(A,k,this.processOfflineEvents.bind(this))):(T.log("Analytics consent withdrawn"),i.clearAllTracking(!0))),!0},get:function(t){switch(t){case"client_id":return k.clientId;case"user_id":return k.userId;case"session_id":return k.sessionId;case"hit_count":return k.hitCount;case"consent_status":return Object.assign({},k.consentStatus);case"debug_mode":return A.debug;default:return k.persistentParameters[t]}}};t._trdt_uat=Object.assign((function(){var e=Array.from(arguments);return 0===e.length?t._trdt_uat:"string"==typeof e[0]?j.command.apply(j,e):(T.error("Invalid attrib function call"),!1)}),j),t.attrib=t.attrib||function(){var e=Array.from(arguments);return A.initialized||"init"===e[0]?t._trdt_uat.apply(null,e):(p(t,e),Promise.resolve("Command queued"))},t._trdt_uat_queue.length>0&&(T.log("Found existing queue with",t._trdt_uat_queue.length,"commands"),v(t,j.command.bind(j),A.debug).catch((function(t){T.error("Error processing init command from queue:",t)}))),void 0!==d&&void 0!==t&&(t.addEventListener("online",(function(){A.initialized&&i.canUseStorage(k.consentStatus)&&j.processOfflineEvents()})),d.addEventListener("visibilitychange",(function(){"visible"===d.visibilityState&&A.initialized&&i.canUseStorage(k.consentStatus)&&j.processOfflineEvents()})),t.addEventListener("beforeunload",(function(){"function"==typeof navigator.sendBeacon&&k.queue.length>0&&A.initialized&&k.queue.forEach((function(t){if("event"===t[0]){var e=t[1],n=t[2]||{},r=Object.assign({},n,{event_name:e}),o=T.serializeEvent(r);u(o,A)}}))})))}(window,document),t.default})()));